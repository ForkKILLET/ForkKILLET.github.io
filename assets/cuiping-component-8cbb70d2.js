import{a as or,c as Rr,r as Ft,p as _r,f as vt,g as Mt,i as Ot,n as Ie,C as Le,h as pt,l as Ir,t as xe,j as Lr}from"./vendor-39cd1860.js";const U={rem:(h,t)=>{const e=h%t;return isNaN(e)?e:e<0?e+t:e},stdAng:h=>U.rem(h,360),d2r:h=>h/180*Math.PI,r2d:h=>h/Math.PI*180,round:(h,t)=>{if(!Number.isInteger(t)||t<0)throw RangeError("n must be a postive integer");const e=10**t;return Math.round(h*e)/e},sind:h=>U.round(Math.sin(U.d2r(h)),7),cosd:h=>U.round(Math.cos(U.d2r(h)),7),tand:h=>U.round(Math.tan(U.d2r(h)),7)},Dr=h=>h.length?1+(h.length-1)*.6:0,rt=(h,t)=>t.includes(h),hr=` 		
`,Xt="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",Br=Xt+".,",De=Xt+"^_`()?.",cr=",}",$r="~&<>:+-.",zr=cr+$r+Xt,lr="=#",Ae="-|/\\+@",ur="*!~:",Be=lr+Ae+ur,Fr={"^":"sup",_:"sub","`":"base"},Ur={"=":2,"#":3},Hr={"-":[0],"/":[300],"|":[270],"\\":[60],"+":[0,90,180,270]},Xr={"*":"zeroWidth","!":"add180Deg","~":"useInferred",":":"useDefDeg"},gr=(h,{abbrLabel:t})=>{if(t){if(h.ref)throw Error(`Abbr label '${t} exists, so extra 'ref' attr is not allowed.`);h.ref=t}},$e=(h,{bondType:t})=>{var e;const r=(e=h.from)!==null&&e!==void 0?e:h.to,{c:i}=t;if(r>i)throw Error(`Coordinated bonds (${r}) more than total bonds (${i}).`)},Yr={color:{type:"string"},C:"color",bold:{type:"boolean"},B:"bold",ref:{type:"string",validate:gr},"&":"ref"},qr={color:{type:"string"},C:"color",highEnergy:{type:"boolean"},HE:"highEnergy","~":"highEnergy",from:{type:"union",options:[{type:"boolean"},{type:"integer",min:1,max:3,validate:$e}]},"<":"from",to:{type:"union",options:[{type:"boolean"},{type:"integer",min:1,max:3,validate:$e}]},">":"to",length:{type:"float",min:0},L:"length",side:{type:"union",options:[{type:"const",value:"L"},{type:"const",value:"R"}]},S:"side"},Wr={ref:{type:"string",validate:gr},"&":"ref",deg:{type:"float"}},jr=(h,t)=>h in t;class Qr{constructor(t){this.str=t,this.used=!1,this.index=0}expect(t,e){return Error(`Expecting ${t}, but got ${e??(this.current?`'${this.current}'`:"end of input")}.`)}get current(){return this.str[this.index]}get after(){return this.str.slice(this.index+1)}getStr(){return this.str}parse(){if(this.used)throw Error("Parser is already used.");this.used=!0;const t=this.doParse();if(this.index!==this.str.length)throw Error(`Unexcepted trailing characters '${this.current+this.after}'`);return t}try(t){const e=this.index;let r,i;try{r=t()}catch(s){i=s}return{except:(s,a)=>{if(!i)return r;if(i.message.startsWith(`Expecting ${s}`))return this.index=e,a;throw i},catch:s=>i?(this.index=e,s):r}}maybeSpace(){for(;rt(this.current,hr);)this.index++}doParseNumber(){let t=0,e=!1,r=!1,i;for(this.current==="-"&&(e=!0,this.index++);;){if(this.current==="."){const s=this.after[0];if(!s||s<"0"||s>"9"||i)break;i=.1}else if(this.current>="0"&&this.current<="9")r=!0,i?t+=+this.current*i:t=t*10+ +this.current;else break;this.index++}if(!r)throw this.expect("number");return t*(e?-1:1)}}class dr extends Qr{constructor(t,e={}){super(t),this.defs=e,this.labels={},this.groups=[],this.groupId=0}maybeSpace(){for(super.maybeSpace();this.current==="("&&this.after[0]==="*";){let t=!1;for(this.index+=2;this.current;){if(this.current==="*"&&this.after[0]===")"){t=!0,this.index+=2;break}this.index++}if(!t)throw Error("Unclosed comment");super.maybeSpace()}}doParseAttr(t){const e={};if(this.current==="{"){this.index++,this.maybeSpace();let i="",s=!1;t:for(;this.current;){if(rt(this.current,hr)&&(this.maybeSpace(),s&&!rt(this.current,cr)))throw Error("Attr value mustn't contain white spaces.");if(!rt(this.current,zr))throw Error(`unexpected char '${this.current}' in attr`);switch(this.current){case"}":s||i&&(e[i]=!0);break t;case":":this.index++,this.maybeSpace(),s=!0,e[i]="";break;case",":if(this.index++,this.maybeSpace(),!s)if(i)e[i]=!0;else throw this.expect("Attribute key");i="",s=!1;break;default:s?e[i]+=this.current:i+=this.current,this.index++}}if(!this.current)throw this.expect("delimiter '}' of attributes");this.index++,this.maybeSpace()}const r=Object.values(t).map(i=>typeof i=="string"?void 0:i.validate).filter(i=>!!i);for(const i in e)if(jr(i,t)){let s=t[i];typeof s=="string"&&(e[s]=e[i],s=t[s]);const a=typeof e[i];let n=!1,o;const c=(l,d=!1)=>{const g=l.type;if(g==="union"){for(const u of l.options)if(c(u,!0),n)return}if(a===g||a==="string"&&e[i]&&!isNaN(+e[i])&&(g==="integer"||g==="float")||g==="const"&&e[i]===l.value){switch(g){case"integer":case"float":if(g==="integer"&&!Number.isInteger(+e[i])){o="not integer";return}if(l.min!==void 0&&+e[i]<l.min){o=`less than min value ${l.min}`;return}if(l.max!==void 0&&+e[i]>l.max){o=`greater than max value ${l.max}`;return}e[i]=+e[i]}d&&l.validate&&r.push(l.validate),n=!0}};if(c(s),!n)throw this.expect(`attribute '${i}' to satisfy ${JSON.stringify(s)}`,e[i]+(o?": "+o:""))}else throw Error(`Unknown attribute '${i}'.`);return{raw:e,validate(i){return r.forEach(s=>{s(this.raw,i)}),this.raw}}}doParseGroup(){let t="",e="";const r=this.index,i=[];let s=!1,a=!1,n=!1,o="base",c=!1,l=!1;const d=(x=!1)=>{if(!x&&!e)return;let w=Dr(e);const E=!n&&e==="?";n&&(n=!1),o!=="base"&&(w/=2),i.push({s:e,w,a:o,cd:l,nd:E})};for(this.current==="."&&(l=!0,t+=".",this.index++);this.current&&(rt(this.current,De)||s||a);){const x=this.current;x==="^"||x==="_"||x==="`"?(d(),e="",o=Fr[x],this.after[0]==="{"?(a=!0,this.index++):s=!0,n=!0):x==="}"&&a?a=!1:((x<"0"||x>"9")&&(c=!0,(x<"a"||x>"z")&&(x<"A"||x>"Z")&&(c=!1)),!s&&e[0]>="A"&&e[0]<="Z"&&x>="a"&&x<="z"?e+=x:(d(),e=x,s?s=!1:a||(x>="0"&&x<="9"&&c?o="sub":o!=="base"&&(o="base")))),t+=x,this.index++}d(l);const g=this.index-1;if(this.maybeSpace(),n)throw Error(`Unclosed ${o.replace("_","")} typeset in group typeset '${t}'`);if(!t)throw this.expect("atom group");const u={B:i,w:i.reduce((x,w)=>x+w.w,0)},p=[r,g],f=this.groupId++;let m;this.current==="'"&&(m=this.doParseLabelAbbr());const y=this.doParseAttr(Yr).validate({group:{t:u,a:{},R:p,i:f},abbrLabel:m}),v={t:u,a:y,R:p,i:f};return this.groups.push(v),v}checkDupBondDir(t,e,r){return e.includes(r)||t.some(({d:i})=>i.includes(r))}doParseBondModifiers(){const t={};for(;rt(this.current,ur);){const e=Xr[this.current];if(t[e])throw Error(`Duplicated bond modifier ${this.current}`);t[e]=!0,this.index++}return t}doParseBondType({isPrefix:t=!1,parsedBonds:e=[],dirFrom:r}){let i=1;const s=[],a=this.doParseBondModifiers();if(rt(this.current,lr)&&(i=Ur[this.current],this.index++),!a.useDefDeg){const o=!rt(this.current,Ae),c=o&&(i>1||a.zeroWidth),l=o&&a.add180Deg,d=o&&a.useInferred;for(;rt(this.current,Ae)||c||d||l;){const g=[];if(d){if(a.add180Deg?r===150||r===null?g.push(30):r===210&&g.push(330):r===30||r===null?g.push(330):r===330&&g.push(30),!g.length)throw Error(`Cannot infer the direction of '${a.add180Deg?"!":""}~' (from direction ${r} deg)`)}else if(c||l)g.push(0);else if(this.current==="@"){this.index++;let u=!1,p=!1,f=!1;const m=this.current;m==="!"?(u=!0,this.index++):m==="|"?(f=!0,this.index++):m==="_"&&(p=!0,this.index++);let y=U.stdAng(-this.doParseNumber());if(a.useInferred){if(r===null)throw Error("Not implemented: Cannot infer relative direction for postfix bonds");y=U.stdAng(r-180-y)}g.push(y),u?g.push(U.stdAng(y+180)):f?g.push(U.stdAng(180-y)):p&&g.push(U.stdAng(-y))}else g.push(...Hr[this.current]),this.index++;for(let u of g){if(a.useInferred&&(u===60?u=30:u===300&&(u=330)),a.add180Deg&&(u=U.stdAng(u+180)),t||(u=U.stdAng(u+180)),s.includes(u)&&(u=U.stdAng(u+180)),this.checkDupBondDir(e,s,u))throw Error(`Duplicated bond direction (${g} deg)`);s.push(u)}if(c||d||l)break}if(!s.length)throw this.expect("at least one bond direction")}this.maybeSpace();const n=this.doParseAttr(qr).validate({bondType:{c:i,d:s,a:{}}});return a.zeroWidth&&(n.length=0),{c:i,d:s,a:n}}doParseBond({requirePrefix:t=!1,parsedBonds:e=[],self:r,dirFrom:i}){let s;if(rt(this.current,Be)){const{c:o,d:c,a:l}=this.doParseBondType({isPrefix:!0,parsedBonds:e,dirFrom:i}),d=this.doParseStruct({dirFrom:c[0]});s={c:o,d:c,a:l,n:d}}else{if(t)throw this.expect("prefix-styled bond");if(rt(this.current,De)||this.current==="&"||this.current==="$"){const o=this.doParseStruct({dirFrom:null}),{c,d:l,a:d}=this.doParseBondType({isPrefix:!1,parsedBonds:e,dirFrom:i});s={c,d:l,a:d,n:o}}else throw this.expect("bond")}this.maybeSpace();const a=s.d.map(o=>U.stdAng(o+180));if(s.n.children.some(({d:o})=>o.some(c=>c===a[0])))throw Error(`Duplicated bond direction (${a[0]}deg, same as parent)`);const n={c:s.c,d:[...a],a:Object.assign({},s.a),n:r};return n.a.side=s.a.side==="L"?"R":s.a.side==="R"?"L":void 0,s.n.parents.push(n),s}doParseBonds({dirFrom:t,self:e}){const r=[];if(this.current==="["){for(this.index++,this.maybeSpace();;)if(r.push(this.doParseBond({parsedBonds:r,self:e,dirFrom:t})),this.current===","&&this.index++,this.maybeSpace(),this.current==="]"){this.index++,this.maybeSpace();break}}if(rt(this.current,Be)){const i=this.try(()=>this.doParseBond({parsedBonds:r,self:e,dirFrom:t})).except("atom group",null);i&&r.push(i)}return r}doParseFuncCall(){this.index++;let t="";for(;rt(this.current,Xt);)t+=this.current,this.index++;this.maybeSpace();const e=this.defs[t];if(!e)throw Error(`Unknown func struct "${t}"`);if(e.type!=="chem")throw this.expect("func struct of chem type",`${e.type} type`);let r;this.current==="'"&&(r=this.doParseLabelAbbr());const i=this.doParseAttr(Object.assign(Object.assign({},e.attr),Wr)).validate({abbrLabel:r});return{d:e,a:i}}doParseLabelAbbr(){this.index++;let t="";for(;rt(this.current,Xt);)t+=this.current,this.index++;if(!t)throw Error("Abbr label cannot be empty.");return this.maybeSpace(),t}doParseRef(){this.index++;const t=[];let e="";for(;rt(this.current,Br);){switch(this.current){case",":t.push(e),e="";break;default:e+=this.current}this.index++}return t.push(e),{l:t}}doParseStructHead(){switch(this.current){case"&":return{S:"ref",node:this.doParseRef()};case"$":return{S:"func",node:this.doParseFuncCall()};default:return{S:"chem",node:this.doParseGroup()}}}doParseStruct({dirFrom:t=null}){const e=this.doParseStructHead();this.maybeSpace();const r=Object.assign(Object.assign({},e),{children:null,parents:[]});if(r.children=this.doParseBonds({self:r,dirFrom:t}),e.S==="chem"){const i=e.node.a.ref;if(i){if(this.labels[i])throw Error(`Not implemented: shared ref (label '${i}')`);this.labels[i]=r}}return r}doParse(){const t=[];for(this.maybeSpace();(t.push(this.doParseStruct({dirFrom:null})),this.maybeSpace(),this.current===";")&&(this.index++,this.maybeSpace(),!!this.current););return{structs:t,labels:this.labels,groups:this.groups}}}var pr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ne={};Object.defineProperty(ne,"__esModule",{value:!0});ne.default=Yt;ne.formatKeys=fr;function Yt(h,t){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:new Map,r=e.get(h);if(r)return r;if(Array.isArray(h)){var i=[];e.set(h,i);for(var s=0;s<h.length;s++)i[s]=Yt(h[s],t,e);return i}if(h instanceof Date)return new Date(h.valueOf());if(!(h instanceof Object))return h;var a={};e.set(h,a);for(var n=Object.keys(h),o=0;o<n.length;o++){var c=t?t(n[o]):n[o];a[c]=Yt(h[n[o]],t,e)}return a}function fr(h){return function(t){return Yt(t,h)}}Yt.formatKeys=fr;var ze=ne.default;function mr(h){let t=0,e=0,r=0;const i=g=>{var u,p;return(u=(p=g.node.a).ref)!==null&&u!==void 0?u:p.ref=`unnamed:${r++}:`};function s(g){var u;let p;const f=[];if(g.S==="func"){const m=g.node.d;if(m.type==="chem"){const y=i(g),v=(x,w,E=null)=>{const C={S:x.S,node:ze(x.node),children:x.children,parents:E&&x.parents.length?[Object.assign(Object.assign({},ze(x.parents[0])),{d:x.parents[0].d.map(S=>U.stdAng(S+w)),n:E})]:[]};if(C.children=C.children.map(S=>Object.assign(Object.assign({},S),{d:S.d.map(M=>U.stdAng(M+w)),n:v(S.n,w,C)})),x.S==="chem"){const S=x.node.a.ref;if(S&&S in m.chem.exposedLabels){const M=m.chem.exposedLabels[S];C.labelDef=M,h.labels[y+S]=C}}return C};p={S:"ref",node:{l:[y+m.chem.defaultOut]},parents:[],children:g.children},p.children.forEach(x=>{x.n.parents[0].n=p}),f.push(v(m.chem.proto,(u=g.node.a.deg)!==null&&u!==void 0?u:0))}else throw Error(`Not implemented: func struct of ${m.type}`)}else p=g;return p.children.forEach(m=>{const{n:y}=m;if(y.S==="func"&&y.node.d.type==="chem"){const w=i(y);m.n={S:"ref",node:{l:[w+y.node.d.chem.defaultIn]},parents:y.parents,children:[]},m.n.parents[0].n.children[0].n=m.n}const[v,...x]=s(y);y.S==="func"&&y.node.d.type==="chem"&&f.push(v),f.push(...x)}),[p,...f]}function a(g){if(g.S==="ref"){const u=g.node.l[0];g=h.labels[u]}return g}function n(g,u){const{children:p,parents:f}=g;if(g.S==="ref"){const m=g.node.l[0],y=h.labels[m];if(!y)throw Error(`Unknown ref &${m}`);g=y,g.children.push(...p),g.parents.push(...f)}if(p.forEach(m=>{if(m.n.S==="ref"&&a(m.n)===g)throw Error(`Self-loop on ref &${m.n.node.l[0]}`);if(m.n.parents.forEach(y=>{y.n=a(y.n)}),!m.d.length){if(g.S==="chem"){const{labelDef:y}=g;if(typeof(y==null?void 0:y.defaultDir)=="number"){m.d.push(y.defaultDir);return}}throw Error("No default dir")}}),g.S==="func")throw Error("Unreachable: uncalled func structs");return g[`toGraph${u}Visited`]=!0,g.toGraphAnyVisited||(g.toGraphAnyVisited=!0,t++),g.children.forEach(m=>{const y=a(m.n);y[`toGraph${u}Visited`]?m.n=y:m.n=n(m.n,u)}),g}function o(g,u){return g.parents.forEach(p=>{p.n!==u&&(p.n.invertVisited=!0,g.children.push(p),p.n.children=p.n.children.filter(f=>f.n!==g))}),g}function c(g,u){g.toTreeVisited||(g.toTreeVisited=!0,e++),o(g,u);const p=[];return g.children.forEach(f=>{f.n.toTreeVisited?f.n={S:"chem",node:{t:{B:[{s:"",w:1,a:"base",nd:!0}],w:1},a:{},R:[-1,-1],i:-1},children:[],parents:[]}:f.n=c(f.n,g)}),p.forEach(f=>g.children.splice(f,1)),g}const l=h.structs.flatMap(s).map(n),d=c(l[0],null);if(e<t)throw Error(`Structs aren't connected. (nodes ${e} / ${t})`);return d}function yr(h,t=0,e=!1,r=!1,i=0){const s=[];return h.children.forEach(a=>{const[n]=a.d;a.d.forEach((o,c)=>{let l=t,d=e,g=r;if(c)if(o+n===360)g=!g;else if(o+n===180)d=!d;else{const f=o-n;l+=U.stdAng(e===r?f:-f)}o+=t,e&&(o=180-o),r&&(o=360-o),o=U.stdAng(o);const u=yr(Object.assign({},a.n),l,d,g,i+1),p=Object.assign({},a.a);e!==r&&(p.side=p.side==="L"?"R":p.side==="R"?"L":void 0),s.push({c:a.c,a:p,d:o,t:u,f:h.node})})}),{g:h.node,bonds:s}}const Fe=/["&'<>$\x80-\uFFFF]/g,Gr=new Map([[34,"&quot;"],[38,"&amp;"],[39,"&apos;"],[60,"&lt;"],[62,"&gt;"]]),Zr=String.prototype.codePointAt!=null?(h,t)=>h.codePointAt(t):(h,t)=>(h.charCodeAt(t)&64512)===55296?(h.charCodeAt(t)-55296)*1024+h.charCodeAt(t+1)-56320+65536:h.charCodeAt(t);function Jr(h){let t="",e=0,r;for(;(r=Fe.exec(h))!==null;){const i=r.index,s=h.charCodeAt(i),a=Gr.get(s);a!==void 0?(t+=h.substring(e,i)+a,e=i+1):(t+=`${h.substring(e,i)}&#x${Zr(h,i).toString(16)};`,e=Fe.lastIndex+=+((s&64512)===55296))}return t+h.substr(e)}function Kr(h,{unitLen:t=20,halfTextBoxWidth:e=6,halfTextBoxHeight:r=8}){const i=[],s=[],a=(n,o,c,l,d)=>{i.push(Object.assign(Object.assign({},n.g),{x:o,y:c,xo:l,yo:d}));const g=n.g.t.w*2,u=n.g.t.B[0].w;n.bonds.forEach(p=>{var f;const m=U.cosd(p.d)>0?g-u:-u,y=p.d<180?1:-1,v=y/m,x=U.tand(p.d),{t:w}=n.g,{cd:E}=w.B[0],C=E?0:e*(Math.abs(x)>Math.abs(v)?y/x:m),S=p.a.length===0,M=E&&!(w.B[0].s&&S)?0:r*(Math.abs(x)>Math.abs(v)?y:m*x),{t:H}=p.t.g,{cd:L}=H.B[0],Y=((f=p.a.length)!==null&&f!==void 0?f:1)*t,q=o+U.cosd(p.d)*Y,W=o+U.cosd(p.d)*(Y+(L?0:H.B[0].w*e)),I=c+U.sind(p.d)*Y,V=c+U.sind(p.d)*(Y+(L?0:r)),G=U.cosd(p.d)>=0?0:(-H.w+H.B[0].w)*2*e;s.push({g1:p.f,g2:p.t.g,x1:o,y1:c,x2:q,y2:I,xo:l+C,yo:d+M,c:p.c,a:p.a}),a(p.t,W,V,l+C+G,d+M)})};return a(h,0,0,0,0),{groups:i,bonds:s}}function ti(h,t){let e=1/0,r=1/0,i=-1/0,s=-1/0;for(const a of h.groups){if(a.i<0)continue;const n=a.y+a.yo;if(n<r&&(r=n),n>s&&(s=n),a.t.B[0].nd){const o=a.x+a.xo;o<e&&(e=o),o>i&&(i=o)}else{const o=a.t.w?a.t.B[0].w*t:0,c=a.x+a.xo-o,l=a.x+a.xo+a.t.w*2*t-o;c<e&&(e=c),l>i&&(i=l)}}return{xMin:e,yMin:r,xMax:i,yMax:s,xOffset:-e,yOffset:-r,width:i-e,height:s-r}}function ei(h,t={}){var e,r,i,s,a,n,o,c,l,d;const g=Kr(h,t),{unitLen:u=20,paddingX:p=20,paddingY:f=20,displayBonds:m=!0,bondGap:y=2,lineBaseColor:v="black",textBaseColor:x="black",displayBackground:w=!1,backgroundColor:E="white",halfFontSize:C=8,halfTextBoxWidth:S=6,halfTextBoxHeight:M=8,displayTextBox:H=!1}=t;let L="";const Y=ti(g,S),q={x:0,y:0},W=T=>U.round(T,7),I=T=>W(T+Y.xOffset+p+q.x),V=T=>W(T+Y.yOffset+f+q.y),G=T=>T.length?" "+T.join(" "):"",$=(T,P,k,_,et,at=!1,ot=!1)=>{L+=`<line x1="${I(T)}" y1="${V(P)}" x2="${I(k)}" y2="${V(_)}"${G(et)}></line>`,at&&tt(T,P,k,_,et),ot&&tt(k,_,T,P,et)},tt=(T,P,k,_,et)=>{const at=4*(k-T)/u,ot=4*(_-P)/u,N=1.5,D=N*(_-P)/u,B=N*(k-T)/u;L+=`<path d="M ${I(k)} ${V(_)}L ${I(k-at+D)} ${V(_-ot-B)}L ${I(k-at-D)} ${V(_-ot+B)} Z"${G([...et,'tofill=""'])}></path>`},R=`mol-${Math.random()*1e6|0}-${Date.now().toString().slice(-10)}`,z=W(Y.width+p*2),Z=W(Y.height+f*2);if(L+=`<svg id="${R}" xmlns="http://www.w3.org/2000/svg" width="${z}" height="${Z}" viewBox="0 0 ${z} ${Z}">`,L+=`<style>#${R} text {dominant-baseline: central;text-anchor: middle;font-size: ${C*2}px;font-family: serif;}#${R} text:not([nobasecolor]) {fill: ${x};}#${R} path:not([tofill]) {fill: none;}#${R} path[tofill] {fill: ${v};}#${R} text[box-align=sub] {font-size: ${C*1.5}px;dominant-baseline: hanging;}#${R} text[box-align=sup] {font-size: ${C*1.5}px;dominant-baseline: alphabetic;}#${R} text[bold] {font-weight: bold;}#${R} line:not([nobasecolor]):not([debug]), #${R} path:not([nobasecolor]) {stroke: ${v};}#${R} [debug] {stroke: red;fill: none;}#${R} [mask] {fill: ${E};}</style>`,w&&(L+=`<rect x="0" y="0" width="${z}" height="${Z}" fill="${E}"></rect>`),m)for(const{x1:T,y1:P,x2:k,y2:_,xo:et,yo:at,c:ot,a:N}of g.bonds){q.x=et,q.y=at;const D=[];if(N.color&&D.push('nobasecolor=""',`stroke="${N.color}"`),N.highEnergy){const B=(T+.3333333333333333*k)/1.3333333333333333,F=(P+1/3*_)/(1+1/3),bt=(T+3*k)/(1+3),ct=(P+3*_)/(1+3),dt=6*(_-P)/u,zt=6*(k-T)/u;L+=`<path d="M ${I(T)} ${V(P)} C ${I(B+dt)} ${V(F-zt)} ${I(bt-dt)} ${V(ct+zt)} ${I(k)} ${V(_)}"${G(D)}></path>`}else if(ot===1)$(T,P,k,_,D,!!N.to,!!N.from);else if(ot===2)if(N.side){const B=(y+1)*(_-P)/u,F=(y+1)*(k-T)/u;N.side==="L"?($(T,P,k,_,D,!!N.to,!!N.from),$(T+B,P-F,k+B,_-F,D,((e=N.to)!==null&&e!==void 0?e:0)>1,((r=N.from)!==null&&r!==void 0?r:0)>1)):N.side==="R"&&($(T,P,k,_,D,!!N.to,!!N.from),$(T-B,P+F,k-B,_+F,D,((i=N.to)!==null&&i!==void 0?i:0)>1,((s=N.from)!==null&&s!==void 0?s:0)>1))}else{let B=(y/2+.5)*(_-P)/u,F=(y/2+.5)*(k-T)/u;F<0&&(B=-B,F=-F),$(T+B,P-F,k+B,_-F,D,!!N.to,!!N.from),$(T-B,P+F,k-B,_+F,D,((a=N.to)!==null&&a!==void 0?a:0)>1,((n=N.from)!==null&&n!==void 0?n:0)>1)}else if(ot===3){let B=(y+1)*(_-P)/u,F=(y+1)*(k-T)/u;F<0&&(B=-B,F=-F),$(T+B,P-F,k+B,_-F,D,!!N.to,!!N.from),$(T,P,k,_,D,((o=N.to)!==null&&o!==void 0?o:0)>1,((c=N.from)!==null&&c!==void 0?c:0)>1),$(T-B,P+F,k-B,_+F,D,((l=N.to)!==null&&l!==void 0?l:0)>2,((d=N.from)!==null&&d!==void 0?d:0)>2)}}for(const{x:T,y:P,xo:k,yo:_,t:et,a:at,i:ot}of g.groups){q.x=k,q.y=_;let N=0;for(const D of et.B){const B=[];at.color&&B.push('nobasecolor=""',`fill="${at.color}"`),at.bold&&B.push('bold=""'),N>0&&(N+=D.w/2);const F=I(T+(N*2-D.w)*S),bt=V(D.a==="base"?P-M:D.a==="sub"?P-M/4:P-M*3/2),ct=W(S*D.w*2),dt=M*2;D.nd||(D.cd&&(L+=`<rect x="${F}" y="${bt}" width="${ct}" height="${dt}" mask=""></rect>`),D.a!=="base"&&B.push(`box-align="${D.a}"`),L+=`<text x="${I(T+N*2*S)}" y="${V(P)}"${G(B)}>`+Jr(D.s)+"</text>"),H&&(D.cd?($(T-3,P-3,T+3,P+3,['debug=""']),$(T-3,P+3,T+3,P-3,['debug=""'])):L+=`<rect x="${F}" y="${bt}" width="${ct}" height="${dt}" debug=""></rect>`),N+=D.w/2}L+=`<rect group-id="${ot}" fill="none" x="${I(T-et.B[0].w*S)}" y="${V(P-M)}" width="${W(S*N*2+et.B[0].w*S)}" height="${M*2}"></rect>`}return L+="</svg>",{svg:L,id:R,width:z,height:Z}}const ri=h=>{const t=new dr(h,{}).parse();return mr(t)},ii={Ben:{type:"chem",attr:{},chem:{proto:ri(String.raw`.{&:4}/.{&:3}={S:R}.{&:2}\.{&:1}!=/{S:R}.{&:6}!.{&:5}!=\{S:R}&1`),exposedLabels:Object.fromEntries([..."123456"].map(h=>[h,{defaultDir:U.stdAng(60-+h*60)}])),defaultIn:"4",defaultOut:"1"}}};function si(h,t){var e;try{const r=new dr(h,ii).parse(),i=mr(r),s=yr(i);if(t.renderer==="svg")return Object.assign(Object.assign({},ei(s,t.rendererOptions)),{formula:r})}catch(r){(e=t.onError)===null||e===void 0||e.call(t,r)}}var It={exports:{}},Ht={exports:{}};(function(){var h,t,e,r,i,s;typeof performance<"u"&&performance!==null&&performance.now?Ht.exports=function(){return performance.now()}:typeof process<"u"&&process!==null&&process.hrtime?(Ht.exports=function(){return(h()-i)/1e6},t=process.hrtime,h=function(){var a;return a=t(),a[0]*1e9+a[1]},r=h(),s=process.uptime()*1e9,i=r-s):Date.now?(Ht.exports=function(){return Date.now()-e},e=Date.now()):(Ht.exports=function(){return new Date().getTime()-e},e=new Date().getTime())}).call(pr);var ni=Ht.exports,yt=typeof window>"u"?pr:window,ee=["moz","webkit"],Lt="AnimationFrame",Bt=yt["request"+Lt],qt=yt["cancel"+Lt]||yt["cancelRequest"+Lt];for(var Ut=0;!Bt&&Ut<ee.length;Ut++)Bt=yt[ee[Ut]+"Request"+Lt],qt=yt[ee[Ut]+"Cancel"+Lt]||yt[ee[Ut]+"CancelRequest"+Lt];if(!Bt||!qt){var be=0,Ue=0,Et=[],ai=1e3/60;Bt=function(h){if(Et.length===0){var t=ni(),e=Math.max(0,ai-(t-be));be=e+t,setTimeout(function(){var r=Et.slice(0);Et.length=0;for(var i=0;i<r.length;i++)if(!r[i].cancelled)try{r[i].callback(be)}catch(s){setTimeout(function(){throw s},0)}},Math.round(e))}return Et.push({handle:++Ue,callback:h,cancelled:!1}),Ue},qt=function(h){for(var t=0;t<Et.length;t++)Et[t].handle===h&&(Et[t].cancelled=!0)}}It.exports=function(h){return Bt.call(yt,h)};It.exports.cancel=function(){qt.apply(yt,arguments)};It.exports.polyfill=function(h){h||(h=yt),h.requestAnimationFrame=Bt,h.cancelAnimationFrame=qt};var Te=function(h){this.ok=!1,this.alpha=1,h.charAt(0)=="#"&&(h=h.substr(1,6)),h=h.replace(/ /g,""),h=h.toLowerCase();var t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};h=t[h]||h;for(var e=[{re:/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*((?:\d?\.)?\d)\)$/,example:["rgba(123, 234, 45, 0.8)","rgba(255,234,245,1.0)"],process:function(o){return[parseInt(o[1]),parseInt(o[2]),parseInt(o[3]),parseFloat(o[4])]}},{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(o){return[parseInt(o[1]),parseInt(o[2]),parseInt(o[3])]}},{re:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,example:["#00ff00","336699"],process:function(o){return[parseInt(o[1],16),parseInt(o[2],16),parseInt(o[3],16)]}},{re:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,example:["#fb0","f0f"],process:function(o){return[parseInt(o[1]+o[1],16),parseInt(o[2]+o[2],16),parseInt(o[3]+o[3],16)]}}],r=0;r<e.length;r++){var i=e[r].re,s=e[r].process,a=i.exec(h);if(a){var n=s(a);this.r=n[0],this.g=n[1],this.b=n[2],n.length>3&&(this.alpha=n[3]),this.ok=!0}}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.alpha=this.alpha<0?0:this.alpha>1||isNaN(this.alpha)?1:this.alpha,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toRGBA=function(){return"rgba("+this.r+", "+this.g+", "+this.b+", "+this.alpha+")"},this.toHex=function(){var o=this.r.toString(16),c=this.g.toString(16),l=this.b.toString(16);return o.length==1&&(o="0"+o),c.length==1&&(c="0"+c),l.length==1&&(l="0"+l),"#"+o+c+l},this.getHelpXML=function(){for(var o=new Array,c=0;c<e.length;c++)for(var l=e[c].example,d=0;d<l.length;d++)o[o.length]=l[d];for(var g in t)o[o.length]=g;var u=document.createElement("ul");u.setAttribute("id","rgbcolor-examples");for(var c=0;c<o.length;c++)try{var p=document.createElement("li"),f=new RGBColor(o[c]),m=document.createElement("div");m.style.cssText="margin: 3px; border: 1px solid black; background:"+f.toHex()+"; color:"+f.toHex(),m.appendChild(document.createTextNode("test"));var y=document.createTextNode(" "+o[c]+" -> "+f.toRGB()+" -> "+f.toHex());p.appendChild(m),p.appendChild(y),u.appendChild(p)}catch{}return u}};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var xr=function(h,t){return(xr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])})(h,t)};function br(h,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function e(){this.constructor=h}xr(h,t),h.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}function oi(h){var t="";Array.isArray(h)||(h=[h]);for(var e=0;e<h.length;e++){var r=h[e];if(r.type===b.CLOSE_PATH)t+="z";else if(r.type===b.HORIZ_LINE_TO)t+=(r.relative?"h":"H")+r.x;else if(r.type===b.VERT_LINE_TO)t+=(r.relative?"v":"V")+r.y;else if(r.type===b.MOVE_TO)t+=(r.relative?"m":"M")+r.x+" "+r.y;else if(r.type===b.LINE_TO)t+=(r.relative?"l":"L")+r.x+" "+r.y;else if(r.type===b.CURVE_TO)t+=(r.relative?"c":"C")+r.x1+" "+r.y1+" "+r.x2+" "+r.y2+" "+r.x+" "+r.y;else if(r.type===b.SMOOTH_CURVE_TO)t+=(r.relative?"s":"S")+r.x2+" "+r.y2+" "+r.x+" "+r.y;else if(r.type===b.QUAD_TO)t+=(r.relative?"q":"Q")+r.x1+" "+r.y1+" "+r.x+" "+r.y;else if(r.type===b.SMOOTH_QUAD_TO)t+=(r.relative?"t":"T")+r.x+" "+r.y;else{if(r.type!==b.ARC)throw new Error('Unexpected command type "'+r.type+'" at index '+e+".");t+=(r.relative?"a":"A")+r.rX+" "+r.rY+" "+r.xRot+" "+ +r.lArcFlag+" "+ +r.sweepFlag+" "+r.x+" "+r.y}}return t}function Ce(h,t){var e=h[0],r=h[1];return[e*Math.cos(t)-r*Math.sin(t),e*Math.sin(t)+r*Math.cos(t)]}function ut(){for(var h=[],t=0;t<arguments.length;t++)h[t]=arguments[t];for(var e=0;e<h.length;e++)if(typeof h[e]!="number")throw new Error("assertNumbers arguments["+e+"] is not a number. "+typeof h[e]+" == typeof "+h[e]);return!0}var wt=Math.PI;function ve(h,t,e){h.lArcFlag=h.lArcFlag===0?0:1,h.sweepFlag=h.sweepFlag===0?0:1;var r=h.rX,i=h.rY,s=h.x,a=h.y;r=Math.abs(h.rX),i=Math.abs(h.rY);var n=Ce([(t-s)/2,(e-a)/2],-h.xRot/180*wt),o=n[0],c=n[1],l=Math.pow(o,2)/Math.pow(r,2)+Math.pow(c,2)/Math.pow(i,2);1<l&&(r*=Math.sqrt(l),i*=Math.sqrt(l)),h.rX=r,h.rY=i;var d=Math.pow(r,2)*Math.pow(c,2)+Math.pow(i,2)*Math.pow(o,2),g=(h.lArcFlag!==h.sweepFlag?1:-1)*Math.sqrt(Math.max(0,(Math.pow(r,2)*Math.pow(i,2)-d)/d)),u=r*c/i*g,p=-i*o/r*g,f=Ce([u,p],h.xRot/180*wt);h.cX=f[0]+(t+s)/2,h.cY=f[1]+(e+a)/2,h.phi1=Math.atan2((c-p)/i,(o-u)/r),h.phi2=Math.atan2((-c-p)/i,(-o-u)/r),h.sweepFlag===0&&h.phi2>h.phi1&&(h.phi2-=2*wt),h.sweepFlag===1&&h.phi2<h.phi1&&(h.phi2+=2*wt),h.phi1*=180/wt,h.phi2*=180/wt}function He(h,t,e){ut(h,t,e);var r=h*h+t*t-e*e;if(0>r)return[];if(r===0)return[[h*e/(h*h+t*t),t*e/(h*h+t*t)]];var i=Math.sqrt(r);return[[(h*e+t*i)/(h*h+t*t),(t*e-h*i)/(h*h+t*t)],[(h*e-t*i)/(h*h+t*t),(t*e+h*i)/(h*h+t*t)]]}var K,ft=Math.PI/180;function Xe(h,t,e){return(1-e)*h+e*t}function Ye(h,t,e,r){return h+Math.cos(r/180*wt)*t+Math.sin(r/180*wt)*e}function qe(h,t,e,r){var i=1e-6,s=t-h,a=e-t,n=3*s+3*(r-e)-6*a,o=6*(a-s),c=3*s;return Math.abs(n)<i?[-c/o]:function(l,d,g){g===void 0&&(g=1e-6);var u=l*l/4-d;if(u<-g)return[];if(u<=g)return[-l/2];var p=Math.sqrt(u);return[-l/2-p,-l/2+p]}(o/n,c/n,i)}function We(h,t,e,r,i){var s=1-i;return h*(s*s*s)+t*(3*s*s*i)+e*(3*s*i*i)+r*(i*i*i)}(function(h){function t(){return i(function(n,o,c){return n.relative&&(n.x1!==void 0&&(n.x1+=o),n.y1!==void 0&&(n.y1+=c),n.x2!==void 0&&(n.x2+=o),n.y2!==void 0&&(n.y2+=c),n.x!==void 0&&(n.x+=o),n.y!==void 0&&(n.y+=c),n.relative=!1),n})}function e(){var n=NaN,o=NaN,c=NaN,l=NaN;return i(function(d,g,u){return d.type&b.SMOOTH_CURVE_TO&&(d.type=b.CURVE_TO,n=isNaN(n)?g:n,o=isNaN(o)?u:o,d.x1=d.relative?g-n:2*g-n,d.y1=d.relative?u-o:2*u-o),d.type&b.CURVE_TO?(n=d.relative?g+d.x2:d.x2,o=d.relative?u+d.y2:d.y2):(n=NaN,o=NaN),d.type&b.SMOOTH_QUAD_TO&&(d.type=b.QUAD_TO,c=isNaN(c)?g:c,l=isNaN(l)?u:l,d.x1=d.relative?g-c:2*g-c,d.y1=d.relative?u-l:2*u-l),d.type&b.QUAD_TO?(c=d.relative?g+d.x1:d.x1,l=d.relative?u+d.y1:d.y1):(c=NaN,l=NaN),d})}function r(){var n=NaN,o=NaN;return i(function(c,l,d){if(c.type&b.SMOOTH_QUAD_TO&&(c.type=b.QUAD_TO,n=isNaN(n)?l:n,o=isNaN(o)?d:o,c.x1=c.relative?l-n:2*l-n,c.y1=c.relative?d-o:2*d-o),c.type&b.QUAD_TO){n=c.relative?l+c.x1:c.x1,o=c.relative?d+c.y1:c.y1;var g=c.x1,u=c.y1;c.type=b.CURVE_TO,c.x1=((c.relative?0:l)+2*g)/3,c.y1=((c.relative?0:d)+2*u)/3,c.x2=(c.x+2*g)/3,c.y2=(c.y+2*u)/3}else n=NaN,o=NaN;return c})}function i(n){var o=0,c=0,l=NaN,d=NaN;return function(g){if(isNaN(l)&&!(g.type&b.MOVE_TO))throw new Error("path must start with moveto");var u=n(g,o,c,l,d);return g.type&b.CLOSE_PATH&&(o=l,c=d),g.x!==void 0&&(o=g.relative?o+g.x:g.x),g.y!==void 0&&(c=g.relative?c+g.y:g.y),g.type&b.MOVE_TO&&(l=o,d=c),u}}function s(n,o,c,l,d,g){return ut(n,o,c,l,d,g),i(function(u,p,f,m){var y=u.x1,v=u.x2,x=u.relative&&!isNaN(m),w=u.x!==void 0?u.x:x?0:p,E=u.y!==void 0?u.y:x?0:f;function C(T){return T*T}u.type&b.HORIZ_LINE_TO&&o!==0&&(u.type=b.LINE_TO,u.y=u.relative?0:f),u.type&b.VERT_LINE_TO&&c!==0&&(u.type=b.LINE_TO,u.x=u.relative?0:p),u.x!==void 0&&(u.x=u.x*n+E*c+(x?0:d)),u.y!==void 0&&(u.y=w*o+u.y*l+(x?0:g)),u.x1!==void 0&&(u.x1=u.x1*n+u.y1*c+(x?0:d)),u.y1!==void 0&&(u.y1=y*o+u.y1*l+(x?0:g)),u.x2!==void 0&&(u.x2=u.x2*n+u.y2*c+(x?0:d)),u.y2!==void 0&&(u.y2=v*o+u.y2*l+(x?0:g));var S=n*l-o*c;if(u.xRot!==void 0&&(n!==1||o!==0||c!==0||l!==1))if(S===0)delete u.rX,delete u.rY,delete u.xRot,delete u.lArcFlag,delete u.sweepFlag,u.type=b.LINE_TO;else{var M=u.xRot*Math.PI/180,H=Math.sin(M),L=Math.cos(M),Y=1/C(u.rX),q=1/C(u.rY),W=C(L)*Y+C(H)*q,I=2*H*L*(Y-q),V=C(H)*Y+C(L)*q,G=W*l*l-I*o*l+V*o*o,$=I*(n*l+o*c)-2*(W*c*l+V*n*o),tt=W*c*c-I*n*c+V*n*n,R=(Math.atan2($,G-tt)+Math.PI)%Math.PI/2,z=Math.sin(R),Z=Math.cos(R);u.rX=Math.abs(S)/Math.sqrt(G*C(Z)+$*z*Z+tt*C(z)),u.rY=Math.abs(S)/Math.sqrt(G*C(z)-$*z*Z+tt*C(Z)),u.xRot=180*R/Math.PI}return u.sweepFlag!==void 0&&0>S&&(u.sweepFlag=+!u.sweepFlag),u})}function a(){return function(n){var o={};for(var c in n)o[c]=n[c];return o}}h.ROUND=function(n){function o(c){return Math.round(c*n)/n}return n===void 0&&(n=1e13),ut(n),function(c){return c.x1!==void 0&&(c.x1=o(c.x1)),c.y1!==void 0&&(c.y1=o(c.y1)),c.x2!==void 0&&(c.x2=o(c.x2)),c.y2!==void 0&&(c.y2=o(c.y2)),c.x!==void 0&&(c.x=o(c.x)),c.y!==void 0&&(c.y=o(c.y)),c.rX!==void 0&&(c.rX=o(c.rX)),c.rY!==void 0&&(c.rY=o(c.rY)),c}},h.TO_ABS=t,h.TO_REL=function(){return i(function(n,o,c){return n.relative||(n.x1!==void 0&&(n.x1-=o),n.y1!==void 0&&(n.y1-=c),n.x2!==void 0&&(n.x2-=o),n.y2!==void 0&&(n.y2-=c),n.x!==void 0&&(n.x-=o),n.y!==void 0&&(n.y-=c),n.relative=!0),n})},h.NORMALIZE_HVZ=function(n,o,c){return n===void 0&&(n=!0),o===void 0&&(o=!0),c===void 0&&(c=!0),i(function(l,d,g,u,p){if(isNaN(u)&&!(l.type&b.MOVE_TO))throw new Error("path must start with moveto");return o&&l.type&b.HORIZ_LINE_TO&&(l.type=b.LINE_TO,l.y=l.relative?0:g),c&&l.type&b.VERT_LINE_TO&&(l.type=b.LINE_TO,l.x=l.relative?0:d),n&&l.type&b.CLOSE_PATH&&(l.type=b.LINE_TO,l.x=l.relative?u-d:u,l.y=l.relative?p-g:p),l.type&b.ARC&&(l.rX===0||l.rY===0)&&(l.type=b.LINE_TO,delete l.rX,delete l.rY,delete l.xRot,delete l.lArcFlag,delete l.sweepFlag),l})},h.NORMALIZE_ST=e,h.QT_TO_C=r,h.INFO=i,h.SANITIZE=function(n){n===void 0&&(n=0),ut(n);var o=NaN,c=NaN,l=NaN,d=NaN;return i(function(g,u,p,f,m){var y=Math.abs,v=!1,x=0,w=0;if(g.type&b.SMOOTH_CURVE_TO&&(x=isNaN(o)?0:u-o,w=isNaN(c)?0:p-c),g.type&(b.CURVE_TO|b.SMOOTH_CURVE_TO)?(o=g.relative?u+g.x2:g.x2,c=g.relative?p+g.y2:g.y2):(o=NaN,c=NaN),g.type&b.SMOOTH_QUAD_TO?(l=isNaN(l)?u:2*u-l,d=isNaN(d)?p:2*p-d):g.type&b.QUAD_TO?(l=g.relative?u+g.x1:g.x1,d=g.relative?p+g.y1:g.y2):(l=NaN,d=NaN),g.type&b.LINE_COMMANDS||g.type&b.ARC&&(g.rX===0||g.rY===0||!g.lArcFlag)||g.type&b.CURVE_TO||g.type&b.SMOOTH_CURVE_TO||g.type&b.QUAD_TO||g.type&b.SMOOTH_QUAD_TO){var E=g.x===void 0?0:g.relative?g.x:g.x-u,C=g.y===void 0?0:g.relative?g.y:g.y-p;x=isNaN(l)?g.x1===void 0?x:g.relative?g.x:g.x1-u:l-u,w=isNaN(d)?g.y1===void 0?w:g.relative?g.y:g.y1-p:d-p;var S=g.x2===void 0?0:g.relative?g.x:g.x2-u,M=g.y2===void 0?0:g.relative?g.y:g.y2-p;y(E)<=n&&y(C)<=n&&y(x)<=n&&y(w)<=n&&y(S)<=n&&y(M)<=n&&(v=!0)}return g.type&b.CLOSE_PATH&&y(u-f)<=n&&y(p-m)<=n&&(v=!0),v?[]:g})},h.MATRIX=s,h.ROTATE=function(n,o,c){o===void 0&&(o=0),c===void 0&&(c=0),ut(n,o,c);var l=Math.sin(n),d=Math.cos(n);return s(d,l,-l,d,o-o*d+c*l,c-o*l-c*d)},h.TRANSLATE=function(n,o){return o===void 0&&(o=0),ut(n,o),s(1,0,0,1,n,o)},h.SCALE=function(n,o){return o===void 0&&(o=n),ut(n,o),s(n,0,0,o,0,0)},h.SKEW_X=function(n){return ut(n),s(1,0,Math.atan(n),1,0,0)},h.SKEW_Y=function(n){return ut(n),s(1,Math.atan(n),0,1,0,0)},h.X_AXIS_SYMMETRY=function(n){return n===void 0&&(n=0),ut(n),s(-1,0,0,1,n,0)},h.Y_AXIS_SYMMETRY=function(n){return n===void 0&&(n=0),ut(n),s(1,0,0,-1,0,n)},h.A_TO_C=function(){return i(function(n,o,c){return b.ARC===n.type?function(l,d,g){var u,p,f,m;l.cX||ve(l,d,g);for(var y=Math.min(l.phi1,l.phi2),v=Math.max(l.phi1,l.phi2)-y,x=Math.ceil(v/90),w=new Array(x),E=d,C=g,S=0;S<x;S++){var M=Xe(l.phi1,l.phi2,S/x),H=Xe(l.phi1,l.phi2,(S+1)/x),L=H-M,Y=4/3*Math.tan(L*ft/4),q=[Math.cos(M*ft)-Y*Math.sin(M*ft),Math.sin(M*ft)+Y*Math.cos(M*ft)],W=q[0],I=q[1],V=[Math.cos(H*ft),Math.sin(H*ft)],G=V[0],$=V[1],tt=[G+Y*Math.sin(H*ft),$-Y*Math.cos(H*ft)],R=tt[0],z=tt[1];w[S]={relative:l.relative,type:b.CURVE_TO};var Z=function(T,P){var k=Ce([T*l.rX,P*l.rY],l.xRot),_=k[0],et=k[1];return[l.cX+_,l.cY+et]};u=Z(W,I),w[S].x1=u[0],w[S].y1=u[1],p=Z(R,z),w[S].x2=p[0],w[S].y2=p[1],f=Z(G,$),w[S].x=f[0],w[S].y=f[1],l.relative&&(w[S].x1-=E,w[S].y1-=C,w[S].x2-=E,w[S].y2-=C,w[S].x-=E,w[S].y-=C),E=(m=[w[S].x,w[S].y])[0],C=m[1]}return w}(n,n.relative?0:o,n.relative?0:c):n})},h.ANNOTATE_ARCS=function(){return i(function(n,o,c){return n.relative&&(o=0,c=0),b.ARC===n.type&&ve(n,o,c),n})},h.CLONE=a,h.CALCULATE_BOUNDS=function(){var n=function(g){var u={};for(var p in g)u[p]=g[p];return u},o=t(),c=r(),l=e(),d=i(function(g,u,p){var f=l(c(o(n(g))));function m(z){z>d.maxX&&(d.maxX=z),z<d.minX&&(d.minX=z)}function y(z){z>d.maxY&&(d.maxY=z),z<d.minY&&(d.minY=z)}if(f.type&b.DRAWING_COMMANDS&&(m(u),y(p)),f.type&b.HORIZ_LINE_TO&&m(f.x),f.type&b.VERT_LINE_TO&&y(f.y),f.type&b.LINE_TO&&(m(f.x),y(f.y)),f.type&b.CURVE_TO){m(f.x),y(f.y);for(var v=0,x=qe(u,f.x1,f.x2,f.x);v<x.length;v++)0<(R=x[v])&&1>R&&m(We(u,f.x1,f.x2,f.x,R));for(var w=0,E=qe(p,f.y1,f.y2,f.y);w<E.length;w++)0<(R=E[w])&&1>R&&y(We(p,f.y1,f.y2,f.y,R))}if(f.type&b.ARC){m(f.x),y(f.y),ve(f,u,p);for(var C=f.xRot/180*Math.PI,S=Math.cos(C)*f.rX,M=Math.sin(C)*f.rX,H=-Math.sin(C)*f.rY,L=Math.cos(C)*f.rY,Y=f.phi1<f.phi2?[f.phi1,f.phi2]:-180>f.phi2?[f.phi2+360,f.phi1+360]:[f.phi2,f.phi1],q=Y[0],W=Y[1],I=function(z){var Z=z[0],T=z[1],P=180*Math.atan2(T,Z)/Math.PI;return P<q?P+360:P},V=0,G=He(H,-S,0).map(I);V<G.length;V++)(R=G[V])>q&&R<W&&m(Ye(f.cX,S,H,R));for(var $=0,tt=He(L,-M,0).map(I);$<tt.length;$++){var R;(R=tt[$])>q&&R<W&&y(Ye(f.cY,M,L,R))}}return g});return d.minX=1/0,d.maxX=-1/0,d.minY=1/0,d.maxY=-1/0,d}})(K||(K={}));var lt,vr=function(){function h(){}return h.prototype.round=function(t){return this.transform(K.ROUND(t))},h.prototype.toAbs=function(){return this.transform(K.TO_ABS())},h.prototype.toRel=function(){return this.transform(K.TO_REL())},h.prototype.normalizeHVZ=function(t,e,r){return this.transform(K.NORMALIZE_HVZ(t,e,r))},h.prototype.normalizeST=function(){return this.transform(K.NORMALIZE_ST())},h.prototype.qtToC=function(){return this.transform(K.QT_TO_C())},h.prototype.aToC=function(){return this.transform(K.A_TO_C())},h.prototype.sanitize=function(t){return this.transform(K.SANITIZE(t))},h.prototype.translate=function(t,e){return this.transform(K.TRANSLATE(t,e))},h.prototype.scale=function(t,e){return this.transform(K.SCALE(t,e))},h.prototype.rotate=function(t,e,r){return this.transform(K.ROTATE(t,e,r))},h.prototype.matrix=function(t,e,r,i,s,a){return this.transform(K.MATRIX(t,e,r,i,s,a))},h.prototype.skewX=function(t){return this.transform(K.SKEW_X(t))},h.prototype.skewY=function(t){return this.transform(K.SKEW_Y(t))},h.prototype.xSymmetry=function(t){return this.transform(K.X_AXIS_SYMMETRY(t))},h.prototype.ySymmetry=function(t){return this.transform(K.Y_AXIS_SYMMETRY(t))},h.prototype.annotateArcs=function(){return this.transform(K.ANNOTATE_ARCS())},h}(),hi=function(h){return h===" "||h==="	"||h==="\r"||h===`
`},je=function(h){return"0".charCodeAt(0)<=h.charCodeAt(0)&&h.charCodeAt(0)<="9".charCodeAt(0)},ci=function(h){function t(){var e=h.call(this)||this;return e.curNumber="",e.curCommandType=-1,e.curCommandRelative=!1,e.canParseCommandOrComma=!0,e.curNumberHasExp=!1,e.curNumberHasExpDigits=!1,e.curNumberHasDecimal=!1,e.curArgs=[],e}return br(t,h),t.prototype.finish=function(e){if(e===void 0&&(e=[]),this.parse(" ",e),this.curArgs.length!==0||!this.canParseCommandOrComma)throw new SyntaxError("Unterminated command at the path end.");return e},t.prototype.parse=function(e,r){var i=this;r===void 0&&(r=[]);for(var s=function(d){r.push(d),i.curArgs.length=0,i.canParseCommandOrComma=!0},a=0;a<e.length;a++){var n=e[a],o=!(this.curCommandType!==b.ARC||this.curArgs.length!==3&&this.curArgs.length!==4||this.curNumber.length!==1||this.curNumber!=="0"&&this.curNumber!=="1"),c=je(n)&&(this.curNumber==="0"&&n==="0"||o);if(!je(n)||c)if(n!=="e"&&n!=="E")if(n!=="-"&&n!=="+"||!this.curNumberHasExp||this.curNumberHasExpDigits)if(n!=="."||this.curNumberHasExp||this.curNumberHasDecimal||o){if(this.curNumber&&this.curCommandType!==-1){var l=Number(this.curNumber);if(isNaN(l))throw new SyntaxError("Invalid number ending at "+a);if(this.curCommandType===b.ARC){if(this.curArgs.length===0||this.curArgs.length===1){if(0>l)throw new SyntaxError('Expected positive number, got "'+l+'" at index "'+a+'"')}else if((this.curArgs.length===3||this.curArgs.length===4)&&this.curNumber!=="0"&&this.curNumber!=="1")throw new SyntaxError('Expected a flag, got "'+this.curNumber+'" at index "'+a+'"')}this.curArgs.push(l),this.curArgs.length===li[this.curCommandType]&&(b.HORIZ_LINE_TO===this.curCommandType?s({type:b.HORIZ_LINE_TO,relative:this.curCommandRelative,x:l}):b.VERT_LINE_TO===this.curCommandType?s({type:b.VERT_LINE_TO,relative:this.curCommandRelative,y:l}):this.curCommandType===b.MOVE_TO||this.curCommandType===b.LINE_TO||this.curCommandType===b.SMOOTH_QUAD_TO?(s({type:this.curCommandType,relative:this.curCommandRelative,x:this.curArgs[0],y:this.curArgs[1]}),b.MOVE_TO===this.curCommandType&&(this.curCommandType=b.LINE_TO)):this.curCommandType===b.CURVE_TO?s({type:b.CURVE_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x2:this.curArgs[2],y2:this.curArgs[3],x:this.curArgs[4],y:this.curArgs[5]}):this.curCommandType===b.SMOOTH_CURVE_TO?s({type:b.SMOOTH_CURVE_TO,relative:this.curCommandRelative,x2:this.curArgs[0],y2:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===b.QUAD_TO?s({type:b.QUAD_TO,relative:this.curCommandRelative,x1:this.curArgs[0],y1:this.curArgs[1],x:this.curArgs[2],y:this.curArgs[3]}):this.curCommandType===b.ARC&&s({type:b.ARC,relative:this.curCommandRelative,rX:this.curArgs[0],rY:this.curArgs[1],xRot:this.curArgs[2],lArcFlag:this.curArgs[3],sweepFlag:this.curArgs[4],x:this.curArgs[5],y:this.curArgs[6]})),this.curNumber="",this.curNumberHasExpDigits=!1,this.curNumberHasExp=!1,this.curNumberHasDecimal=!1,this.canParseCommandOrComma=!0}if(!hi(n))if(n===","&&this.canParseCommandOrComma)this.canParseCommandOrComma=!1;else if(n!=="+"&&n!=="-"&&n!==".")if(c)this.curNumber=n,this.curNumberHasDecimal=!1;else{if(this.curArgs.length!==0)throw new SyntaxError("Unterminated command at index "+a+".");if(!this.canParseCommandOrComma)throw new SyntaxError('Unexpected character "'+n+'" at index '+a+". Command cannot follow comma");if(this.canParseCommandOrComma=!1,n!=="z"&&n!=="Z")if(n==="h"||n==="H")this.curCommandType=b.HORIZ_LINE_TO,this.curCommandRelative=n==="h";else if(n==="v"||n==="V")this.curCommandType=b.VERT_LINE_TO,this.curCommandRelative=n==="v";else if(n==="m"||n==="M")this.curCommandType=b.MOVE_TO,this.curCommandRelative=n==="m";else if(n==="l"||n==="L")this.curCommandType=b.LINE_TO,this.curCommandRelative=n==="l";else if(n==="c"||n==="C")this.curCommandType=b.CURVE_TO,this.curCommandRelative=n==="c";else if(n==="s"||n==="S")this.curCommandType=b.SMOOTH_CURVE_TO,this.curCommandRelative=n==="s";else if(n==="q"||n==="Q")this.curCommandType=b.QUAD_TO,this.curCommandRelative=n==="q";else if(n==="t"||n==="T")this.curCommandType=b.SMOOTH_QUAD_TO,this.curCommandRelative=n==="t";else{if(n!=="a"&&n!=="A")throw new SyntaxError('Unexpected character "'+n+'" at index '+a+".");this.curCommandType=b.ARC,this.curCommandRelative=n==="a"}else r.push({type:b.CLOSE_PATH}),this.canParseCommandOrComma=!0,this.curCommandType=-1}else this.curNumber=n,this.curNumberHasDecimal=n==="."}else this.curNumber+=n,this.curNumberHasDecimal=!0;else this.curNumber+=n;else this.curNumber+=n,this.curNumberHasExp=!0;else this.curNumber+=n,this.curNumberHasExpDigits=this.curNumberHasExp}return r},t.prototype.transform=function(e){return Object.create(this,{parse:{value:function(r,i){i===void 0&&(i=[]);for(var s=0,a=Object.getPrototypeOf(this).parse.call(this,r);s<a.length;s++){var n=a[s],o=e(n);Array.isArray(o)?i.push.apply(i,o):i.push(o)}return i}}})},t}(vr),b=function(h){function t(e){var r=h.call(this)||this;return r.commands=typeof e=="string"?t.parse(e):e,r}return br(t,h),t.prototype.encode=function(){return t.encode(this.commands)},t.prototype.getBounds=function(){var e=K.CALCULATE_BOUNDS();return this.transform(e),e},t.prototype.transform=function(e){for(var r=[],i=0,s=this.commands;i<s.length;i++){var a=e(s[i]);Array.isArray(a)?r.push.apply(r,a):r.push(a)}return this.commands=r,this},t.encode=function(e){return oi(e)},t.parse=function(e){var r=new ci,i=[];return r.parse(e,i),r.finish(i),i},t.CLOSE_PATH=1,t.MOVE_TO=2,t.HORIZ_LINE_TO=4,t.VERT_LINE_TO=8,t.LINE_TO=16,t.CURVE_TO=32,t.SMOOTH_CURVE_TO=64,t.QUAD_TO=128,t.SMOOTH_QUAD_TO=256,t.ARC=512,t.LINE_COMMANDS=t.LINE_TO|t.HORIZ_LINE_TO|t.VERT_LINE_TO,t.DRAWING_COMMANDS=t.HORIZ_LINE_TO|t.VERT_LINE_TO|t.LINE_TO|t.CURVE_TO|t.SMOOTH_CURVE_TO|t.QUAD_TO|t.SMOOTH_QUAD_TO|t.ARC,t}(vr),li=((lt={})[b.MOVE_TO]=2,lt[b.LINE_TO]=2,lt[b.HORIZ_LINE_TO]=1,lt[b.VERT_LINE_TO]=1,lt[b.CLOSE_PATH]=0,lt[b.QUAD_TO]=4,lt[b.SMOOTH_QUAD_TO]=2,lt[b.CURVE_TO]=6,lt[b.SMOOTH_CURVE_TO]=4,lt[b.ARC]=7,lt);function se(h){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?se=function(t){return typeof t}:se=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},se(h)}function ui(h,t){if(!(h instanceof t))throw new TypeError("Cannot call a class as a function")}var gi=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],di=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function pi(h,t,e,r,i){if(typeof h=="string"&&(h=document.getElementById(h)),!h||se(h)!=="object"||!("getContext"in h))throw new TypeError("Expecting canvas with `getContext` method in processCanvasRGB(A) calls!");var s=h.getContext("2d");try{return s.getImageData(t,e,r,i)}catch(a){throw new Error("unable to access image data: "+a)}}function fi(h,t,e,r,i,s){if(!(isNaN(s)||s<1)){s|=0;var a=pi(h,t,e,r,i);a=mi(a,t,e,r,i,s),h.getContext("2d").putImageData(a,t,e)}}function mi(h,t,e,r,i,s){for(var a=h.data,n=2*s+1,o=r-1,c=i-1,l=s+1,d=l*(l+1)/2,g=new Qe,u=g,p,f=1;f<n;f++)u=u.next=new Qe,f===l&&(p=u);u.next=g;for(var m=null,y=null,v=0,x=0,w=gi[s],E=di[s],C=0;C<i;C++){u=g;for(var S=a[x],M=a[x+1],H=a[x+2],L=a[x+3],Y=0;Y<l;Y++)u.r=S,u.g=M,u.b=H,u.a=L,u=u.next;for(var q=0,W=0,I=0,V=0,G=l*S,$=l*M,tt=l*H,R=l*L,z=d*S,Z=d*M,T=d*H,P=d*L,k=1;k<l;k++){var _=x+((o<k?o:k)<<2),et=a[_],at=a[_+1],ot=a[_+2],N=a[_+3],D=l-k;z+=(u.r=et)*D,Z+=(u.g=at)*D,T+=(u.b=ot)*D,P+=(u.a=N)*D,q+=et,W+=at,I+=ot,V+=N,u=u.next}m=g,y=p;for(var B=0;B<r;B++){var F=P*w>>E;if(a[x+3]=F,F!==0){var bt=255/F;a[x]=(z*w>>E)*bt,a[x+1]=(Z*w>>E)*bt,a[x+2]=(T*w>>E)*bt}else a[x]=a[x+1]=a[x+2]=0;z-=G,Z-=$,T-=tt,P-=R,G-=m.r,$-=m.g,tt-=m.b,R-=m.a;var ct=B+s+1;ct=v+(ct<o?ct:o)<<2,q+=m.r=a[ct],W+=m.g=a[ct+1],I+=m.b=a[ct+2],V+=m.a=a[ct+3],z+=q,Z+=W,T+=I,P+=V,m=m.next;var dt=y,zt=dt.r,Me=dt.g,ke=dt.b,Ve=dt.a;G+=zt,$+=Me,tt+=ke,R+=Ve,q-=zt,W-=Me,I-=ke,V-=Ve,y=y.next,x+=4}v+=r}for(var Rt=0;Rt<r;Rt++){x=Rt<<2;var Tt=a[x],Ct=a[x+1],Pt=a[x+2],st=a[x+3],ce=l*Tt,le=l*Ct,ue=l*Pt,ge=l*st,Qt=d*Tt,Gt=d*Ct,Zt=d*Pt,Jt=d*st;u=g;for(var Re=0;Re<l;Re++)u.r=Tt,u.g=Ct,u.b=Pt,u.a=st,u=u.next;for(var _e=r,de=0,pe=0,fe=0,me=0,Kt=1;Kt<=s;Kt++){x=_e+Rt<<2;var te=l-Kt;Qt+=(u.r=Tt=a[x])*te,Gt+=(u.g=Ct=a[x+1])*te,Zt+=(u.b=Pt=a[x+2])*te,Jt+=(u.a=st=a[x+3])*te,me+=Tt,de+=Ct,pe+=Pt,fe+=st,u=u.next,Kt<c&&(_e+=r)}x=Rt,m=g,y=p;for(var ye=0;ye<i;ye++){var nt=x<<2;a[nt+3]=st=Jt*w>>E,st>0?(st=255/st,a[nt]=(Qt*w>>E)*st,a[nt+1]=(Gt*w>>E)*st,a[nt+2]=(Zt*w>>E)*st):a[nt]=a[nt+1]=a[nt+2]=0,Qt-=ce,Gt-=le,Zt-=ue,Jt-=ge,ce-=m.r,le-=m.g,ue-=m.b,ge-=m.a,nt=Rt+((nt=ye+l)<c?nt:c)*r<<2,Qt+=me+=m.r=a[nt],Gt+=de+=m.g=a[nt+1],Zt+=pe+=m.b=a[nt+2],Jt+=fe+=m.a=a[nt+3],m=m.next,ce+=Tt=y.r,le+=Ct=y.g,ue+=Pt=y.b,ge+=st=y.a,me-=Tt,de-=Ct,pe-=Pt,fe-=st,y=y.next,x+=r}}return h}var Qe=function h(){ui(this,h),this.r=0,this.g=0,this.b=0,this.a=0,this.next=null};function $t(h){return h.replace(/(?!\u3000)\s+/gm," ")}function yi(h){return h.replace(/^[\n \t]+/,"")}function xi(h){return h.replace(/[\n \t]+$/,"")}function ht(h){const t=h.match(/-?(\d+(?:\.\d*(?:[eE][+-]?\d+)?)?|\.\d+)(?=\D|$)/gm);return t?t.map(parseFloat):[]}function bi(h){const t=ht(h);return[t[0]||0,t[1]||0,t[2]||0,t[3]||0,t[4]||0,t[5]||0]}const vi=/^[A-Z-]+$/;function wi(h){return vi.test(h)?h.toLowerCase():h}function wr(h){const t=/url\(('([^']+)'|"([^"]+)"|([^'")]+))\)/.exec(h);return t&&(t[2]||t[3]||t[4])||""}function Si(h){if(!h.startsWith("rgb"))return h;let t=3;return h.replace(/\d+(\.\d+)?/g,(e,r)=>t--&&r?String(Math.round(parseFloat(e))):e)}const Ai=/(\[[^\]]+\])/g,Ti=/(#[^\s+>~.[:]+)/g,Ci=/(\.[^\s+>~.[:]+)/g,Pi=/(::[^\s+>~.[:]+|:first-line|:first-letter|:before|:after)/gi,Oi=/(:[\w-]+\([^)]*\))/gi,Ei=/(:[^\s+>~.[:]+)/g,Ni=/([^\s+>~.[:]+)/g;function Nt(h,t){const e=t.exec(h);return e?[h.replace(t," "),e.length]:[h,0]}function Mi(h){const t=[0,0,0];let e=h.replace(/:not\(([^)]*)\)/g,"     $1 ").replace(/{[\s\S]*/gm," "),r=0;return[e,r]=Nt(e,Ai),t[1]+=r,[e,r]=Nt(e,Ti),t[0]+=r,[e,r]=Nt(e,Ci),t[1]+=r,[e,r]=Nt(e,Pi),t[2]+=r,[e,r]=Nt(e,Oi),t[1]+=r,[e,r]=Nt(e,Ei),t[1]+=r,e=e.replace(/[*\s+>~]/g," ").replace(/[#.]/g," "),[e,r]=Nt(e,Ni),t[2]+=r,t.join("")}const Dt=1e-8;function Ge(h){return Math.sqrt(Math.pow(h[0],2)+Math.pow(h[1],2))}function Pe(h,t){return(h[0]*t[0]+h[1]*t[1])/(Ge(h)*Ge(t))}function Ze(h,t){return(h[0]*t[1]<h[1]*t[0]?-1:1)*Math.acos(Pe(h,t))}function Je(h){return h*h*h}function Ke(h){return 3*h*h*(1-h)}function tr(h){return 3*h*(1-h)*(1-h)}function er(h){return(1-h)*(1-h)*(1-h)}function rr(h){return h*h}function ir(h){return 2*h*(1-h)}function sr(h){return(1-h)*(1-h)}class A{static empty(t){return new A(t,"EMPTY","")}split(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:" ";const{document:e,name:r}=this;return $t(this.getString()).trim().split(t).map(i=>new A(e,r,i))}hasValue(t){const e=this.value;return e!==null&&e!==""&&(t||e!==0)&&typeof e<"u"}isString(t){const{value:e}=this,r=typeof e=="string";return!r||!t?r:t.test(e)}isUrlDefinition(){return this.isString(/^url\(/)}isPixels(){if(!this.hasValue())return!1;const t=this.getString();switch(!0){case t.endsWith("px"):case/^[0-9]+$/.test(t):return!0;default:return!1}}setValue(t){return this.value=t,this}getValue(t){return typeof t>"u"||this.hasValue()?this.value:t}getNumber(t){if(!this.hasValue())return typeof t>"u"?0:parseFloat(t);const{value:e}=this;let r=parseFloat(e);return this.isString(/%$/)&&(r/=100),r}getString(t){return typeof t>"u"||this.hasValue()?typeof this.value>"u"?"":String(this.value):String(t)}getColor(t){let e=this.getString(t);return this.isNormalizedColor||(this.isNormalizedColor=!0,e=Si(e),this.value=e),e}getDpi(){return 96}getRem(){return this.document.rootEmSize}getEm(){return this.document.emSize}getUnits(){return this.getString().replace(/[0-9.-]/g,"")}getPixels(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!this.hasValue())return 0;const[r,i]=typeof t=="boolean"?[void 0,t]:[t],{viewPort:s}=this.document.screen;switch(!0){case this.isString(/vmin$/):return this.getNumber()/100*Math.min(s.computeSize("x"),s.computeSize("y"));case this.isString(/vmax$/):return this.getNumber()/100*Math.max(s.computeSize("x"),s.computeSize("y"));case this.isString(/vw$/):return this.getNumber()/100*s.computeSize("x");case this.isString(/vh$/):return this.getNumber()/100*s.computeSize("y");case this.isString(/rem$/):return this.getNumber()*this.getRem();case this.isString(/em$/):return this.getNumber()*this.getEm();case this.isString(/ex$/):return this.getNumber()*this.getEm()/2;case this.isString(/px$/):return this.getNumber();case this.isString(/pt$/):return this.getNumber()*this.getDpi()*(1/72);case this.isString(/pc$/):return this.getNumber()*15;case this.isString(/cm$/):return this.getNumber()*this.getDpi()/2.54;case this.isString(/mm$/):return this.getNumber()*this.getDpi()/25.4;case this.isString(/in$/):return this.getNumber()*this.getDpi();case(this.isString(/%$/)&&i):return this.getNumber()*this.getEm();case this.isString(/%$/):return this.getNumber()*s.computeSize(r);default:{const a=this.getNumber();return e&&a<1?a*s.computeSize(r):a}}}getMilliseconds(){return this.hasValue()?this.isString(/ms$/)?this.getNumber():this.getNumber()*1e3:0}getRadians(){if(!this.hasValue())return 0;switch(!0){case this.isString(/deg$/):return this.getNumber()*(Math.PI/180);case this.isString(/grad$/):return this.getNumber()*(Math.PI/200);case this.isString(/rad$/):return this.getNumber();default:return this.getNumber()*(Math.PI/180)}}getDefinition(){const t=this.getString(),e=/#([^)'"]+)/.exec(t),r=(e==null?void 0:e[1])||t;return this.document.definitions[r]}getFillStyleDefinition(t,e){let r=this.getDefinition();if(!r)return null;if(typeof r.createGradient=="function"&&"getBoundingBox"in t)return r.createGradient(this.document.ctx,t,e);if(typeof r.createPattern=="function"){if(r.getHrefAttribute().hasValue()){const i=r.getAttribute("patternTransform");r=r.getHrefAttribute().getDefinition(),r&&i.hasValue()&&r.getAttribute("patternTransform",!0).setValue(i.value)}if(r)return r.createPattern(this.document.ctx,t,e)}return null}getTextBaseline(){if(!this.hasValue())return null;const t=this.getString();return A.textBaselineMapping[t]||null}addOpacity(t){let e=this.getColor();const r=e.length;let i=0;for(let s=0;s<r&&(e[s]===","&&i++,i!==3);s++);if(t.hasValue()&&this.isString()&&i!==3){const s=new Te(e);s.ok&&(s.alpha=t.getNumber(),e=s.toRGBA())}return new A(this.document,this.name,e)}constructor(t,e,r){this.document=t,this.name=e,this.value=r,this.isNormalizedColor=!1}}A.textBaselineMapping={baseline:"alphabetic","before-edge":"top","text-before-edge":"top",middle:"middle",central:"middle","after-edge":"bottom","text-after-edge":"bottom",ideographic:"ideographic",alphabetic:"alphabetic",hanging:"hanging",mathematical:"alphabetic"};class Wt{clear(){this.viewPorts=[]}setCurrent(t,e){this.viewPorts.push({width:t,height:e})}removeCurrent(){this.viewPorts.pop()}getRoot(){const[t]=this.viewPorts;return t||nr()}getCurrent(){const{viewPorts:t}=this;return t[t.length-1]||nr()}get width(){return this.getCurrent().width}get height(){return this.getCurrent().height}computeSize(t){return typeof t=="number"?t:t==="x"?this.width:t==="y"?this.height:Math.sqrt(Math.pow(this.width,2)+Math.pow(this.height,2))/Math.sqrt(2)}constructor(){this.viewPorts=[]}}Wt.DEFAULT_VIEWPORT_WIDTH=800;Wt.DEFAULT_VIEWPORT_HEIGHT=600;function nr(){return{width:Wt.DEFAULT_VIEWPORT_WIDTH,height:Wt.DEFAULT_VIEWPORT_HEIGHT}}class Q{static parse(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const[r=e,i=e]=ht(t);return new Q(r,i)}static parseScale(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const[r=e,i=r]=ht(t);return new Q(r,i)}static parsePath(t){const e=ht(t),r=e.length,i=[];for(let s=0;s<r;s+=2)i.push(new Q(e[s],e[s+1]));return i}angleTo(t){return Math.atan2(t.y-this.y,t.x-this.x)}applyTransform(t){const{x:e,y:r}=this,i=e*t[0]+r*t[2]+t[4],s=e*t[1]+r*t[3]+t[5];this.x=i,this.y=s}constructor(t,e){this.x=t,this.y=e}}class ki{isWorking(){return this.working}start(){if(this.working)return;const{screen:t,onClick:e,onMouseMove:r}=this,i=t.ctx.canvas;i.onclick=e,i.onmousemove=r,this.working=!0}stop(){if(!this.working)return;const t=this.screen.ctx.canvas;this.working=!1,t.onclick=null,t.onmousemove=null}hasEvents(){return this.working&&this.events.length>0}runEvents(){if(!this.working)return;const{screen:t,events:e,eventElements:r}=this,{style:i}=t.ctx.canvas;let s;i&&(i.cursor=""),e.forEach((a,n)=>{let{run:o}=a;for(s=r[n];s;)o(s),s=s.parent}),this.events=[],this.eventElements=[]}checkPath(t,e){if(!this.working||!e)return;const{events:r,eventElements:i}=this;r.forEach((s,a)=>{let{x:n,y:o}=s;!i[a]&&e.isPointInPath&&e.isPointInPath(n,o)&&(i[a]=t)})}checkBoundingBox(t,e){if(!this.working||!e)return;const{events:r,eventElements:i}=this;r.forEach((s,a)=>{let{x:n,y:o}=s;!i[a]&&e.isPointInBox(n,o)&&(i[a]=t)})}mapXY(t,e){const{window:r,ctx:i}=this.screen,s=new Q(t,e);let a=i.canvas;for(;a;)s.x-=a.offsetLeft,s.y-=a.offsetTop,a=a.offsetParent;return r!=null&&r.scrollX&&(s.x+=r.scrollX),r!=null&&r.scrollY&&(s.y+=r.scrollY),s}onClick(t){const{x:e,y:r}=this.mapXY(t.clientX,t.clientY);this.events.push({type:"onclick",x:e,y:r,run(i){i.onClick&&i.onClick()}})}onMouseMove(t){const{x:e,y:r}=this.mapXY(t.clientX,t.clientY);this.events.push({type:"onmousemove",x:e,y:r,run(i){i.onMouseMove&&i.onMouseMove()}})}constructor(t){this.screen=t,this.working=!1,this.events=[],this.eventElements=[],this.onClick=this.onClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this)}}const Sr=typeof window<"u"?window:null,Ar=typeof fetch<"u"?fetch.bind(void 0):void 0;class xt{wait(t){this.waits.push(t)}ready(){return this.readyPromise?this.readyPromise:Promise.resolve()}isReady(){if(this.isReadyLock)return!0;const t=this.waits.every(e=>e());return t&&(this.waits=[],this.resolveReady&&this.resolveReady()),this.isReadyLock=t,t}setDefaults(t){t.strokeStyle="rgba(0,0,0,0)",t.lineCap="butt",t.lineJoin="miter",t.miterLimit=4}setViewBox(t){let{document:e,ctx:r,aspectRatio:i,width:s,desiredWidth:a,height:n,desiredHeight:o,minX:c=0,minY:l=0,refX:d,refY:g,clip:u=!1,clipX:p=0,clipY:f=0}=t;const m=$t(i).replace(/^defer\s/,""),[y,v]=m.split(" "),x=y||"xMidYMid",w=v||"meet",E=s/a,C=n/o,S=Math.min(E,C),M=Math.max(E,C);let H=a,L=o;w==="meet"&&(H*=S,L*=S),w==="slice"&&(H*=M,L*=M);const Y=new A(e,"refX",d),q=new A(e,"refY",g),W=Y.hasValue()&&q.hasValue();if(W&&r.translate(-S*Y.getPixels("x"),-S*q.getPixels("y")),u){const I=S*p,V=S*f;r.beginPath(),r.moveTo(I,V),r.lineTo(s,V),r.lineTo(s,n),r.lineTo(I,n),r.closePath(),r.clip()}if(!W){const I=w==="meet"&&S===C,V=w==="slice"&&M===C,G=w==="meet"&&S===E,$=w==="slice"&&M===E;x.startsWith("xMid")&&(I||V)&&r.translate(s/2-H/2,0),x.endsWith("YMid")&&(G||$)&&r.translate(0,n/2-L/2),x.startsWith("xMax")&&(I||V)&&r.translate(s-H,0),x.endsWith("YMax")&&(G||$)&&r.translate(0,n-L)}switch(!0){case x==="none":r.scale(E,C);break;case w==="meet":r.scale(S,S);break;case w==="slice":r.scale(M,M);break}r.translate(-c,-l)}start(t){let{enableRedraw:e=!1,ignoreMouse:r=!1,ignoreAnimation:i=!1,ignoreDimensions:s=!1,ignoreClear:a=!1,forceRedraw:n,scaleWidth:o,scaleHeight:c,offsetX:l,offsetY:d}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{mouse:g}=this,u=1e3/xt.FRAMERATE;if(this.isReadyLock=!1,this.frameDuration=u,this.readyPromise=new Promise(v=>{this.resolveReady=v}),this.isReady()&&this.render(t,s,a,o,c,l,d),!e)return;let p=Date.now(),f=p,m=0;const y=()=>{p=Date.now(),m=p-f,m>=u&&(f=p-m%u,this.shouldUpdate(i,n)&&(this.render(t,s,a,o,c,l,d),g.runEvents())),this.intervalId=It.exports(y)};r||g.start(),this.intervalId=It.exports(y)}stop(){this.intervalId&&(It.exports.cancel(this.intervalId),this.intervalId=null),this.mouse.stop()}shouldUpdate(t,e){if(!t){const{frameDuration:r}=this;if(this.animations.reduce((i,s)=>s.update(r)||i,!1))return!0}return!!(typeof e=="function"&&e()||!this.isReadyLock&&this.isReady()||this.mouse.hasEvents())}render(t,e,r,i,s,a,n){const{viewPort:o,ctx:c,isFirstRender:l}=this,d=c.canvas;o.clear(),d.width&&d.height&&o.setCurrent(d.width,d.height);const g=t.getStyle("width"),u=t.getStyle("height");!e&&(l||typeof i!="number"&&typeof s!="number")&&(g.hasValue()&&(d.width=g.getPixels("x"),d.style&&(d.style.width="".concat(d.width,"px"))),u.hasValue()&&(d.height=u.getPixels("y"),d.style&&(d.style.height="".concat(d.height,"px"))));let p=d.clientWidth||d.width,f=d.clientHeight||d.height;if(e&&g.hasValue()&&u.hasValue()&&(p=g.getPixels("x"),f=u.getPixels("y")),o.setCurrent(p,f),typeof a=="number"&&t.getAttribute("x",!0).setValue(a),typeof n=="number"&&t.getAttribute("y",!0).setValue(n),typeof i=="number"||typeof s=="number"){const m=ht(t.getAttribute("viewBox").getString());let y=0,v=0;if(typeof i=="number"){const w=t.getStyle("width");w.hasValue()?y=w.getPixels("x")/i:m[2]&&!isNaN(m[2])&&(y=m[2]/i)}if(typeof s=="number"){const w=t.getStyle("height");w.hasValue()?v=w.getPixels("y")/s:m[3]&&!isNaN(m[3])&&(v=m[3]/s)}y||(y=v),v||(v=y),t.getAttribute("width",!0).setValue(i),t.getAttribute("height",!0).setValue(s);const x=t.getStyle("transform",!0,!0);x.setValue("".concat(x.getString()," scale(").concat(1/y,", ").concat(1/v,")"))}r||c.clearRect(0,0,p,f),t.render(c),l&&(this.isFirstRender=!1)}constructor(t,{fetch:e=Ar,window:r=Sr}={}){if(this.ctx=t,this.viewPort=new Wt,this.mouse=new ki(this),this.animations=[],this.waits=[],this.frameDuration=0,this.isReadyLock=!1,this.isFirstRender=!0,this.intervalId=null,this.window=r,!e)throw new Error("Can't find 'fetch' in 'globalThis', please provide it via options");this.fetch=e}}xt.defaultWindow=Sr;xt.defaultFetch=Ar;xt.FRAMERATE=30;xt.MAX_VIRTUAL_PIXELS=3e4;const{defaultFetch:Vi}=xt,Ri=typeof DOMParser<"u"?DOMParser:void 0;class we{async parse(t){return t.startsWith("<")?this.parseFromString(t):this.load(t)}parseFromString(t){const e=new this.DOMParser;try{return this.checkDocument(e.parseFromString(t,"image/svg+xml"))}catch{return this.checkDocument(e.parseFromString(t,"text/xml"))}}checkDocument(t){const e=t.getElementsByTagName("parsererror")[0];if(e)throw new Error(e.textContent||"Unknown parse error");return t}async load(t){const e=await(await this.fetch(t)).text();return this.parseFromString(e)}constructor({fetch:t=Vi,DOMParser:e=Ri}={}){if(!t)throw new Error("Can't find 'fetch' in 'globalThis', please provide it via options");if(!e)throw new Error("Can't find 'DOMParser' in 'globalThis', please provide it via options");this.fetch=t,this.DOMParser=e}}class _i{apply(t){const{x:e,y:r}=this.point;t.translate(e||0,r||0)}unapply(t){const{x:e,y:r}=this.point;t.translate(-1*e||0,-1*r||0)}applyToPoint(t){const{x:e,y:r}=this.point;t.applyTransform([1,0,0,1,e||0,r||0])}constructor(t,e){this.type="translate",this.point=Q.parse(e)}}class Ii{apply(t){const{cx:e,cy:r,originX:i,originY:s,angle:a}=this,n=e+i.getPixels("x"),o=r+s.getPixels("y");t.translate(n,o),t.rotate(a.getRadians()),t.translate(-n,-o)}unapply(t){const{cx:e,cy:r,originX:i,originY:s,angle:a}=this,n=e+i.getPixels("x"),o=r+s.getPixels("y");t.translate(n,o),t.rotate(-1*a.getRadians()),t.translate(-n,-o)}applyToPoint(t){const{cx:e,cy:r,angle:i}=this,s=i.getRadians();t.applyTransform([1,0,0,1,e||0,r||0]),t.applyTransform([Math.cos(s),Math.sin(s),-Math.sin(s),Math.cos(s),0,0]),t.applyTransform([1,0,0,1,-e||0,-r||0])}constructor(t,e,r){this.type="rotate";const i=ht(e);this.angle=new A(t,"angle",i[0]),this.originX=r[0],this.originY=r[1],this.cx=i[1]||0,this.cy=i[2]||0}}class Li{apply(t){const{scale:{x:e,y:r},originX:i,originY:s}=this,a=i.getPixels("x"),n=s.getPixels("y");t.translate(a,n),t.scale(e,r||e),t.translate(-a,-n)}unapply(t){const{scale:{x:e,y:r},originX:i,originY:s}=this,a=i.getPixels("x"),n=s.getPixels("y");t.translate(a,n),t.scale(1/e,1/r||e),t.translate(-a,-n)}applyToPoint(t){const{x:e,y:r}=this.scale;t.applyTransform([e||0,0,0,r||0,0,0])}constructor(t,e,r){this.type="scale";const i=Q.parseScale(e);(i.x===0||i.y===0)&&(i.x=Dt,i.y=Dt),this.scale=i,this.originX=r[0],this.originY=r[1]}}class Tr{apply(t){const{originX:e,originY:r,matrix:i}=this,s=e.getPixels("x"),a=r.getPixels("y");t.translate(s,a),t.transform(i[0],i[1],i[2],i[3],i[4],i[5]),t.translate(-s,-a)}unapply(t){const{originX:e,originY:r,matrix:i}=this,s=i[0],a=i[2],n=i[4],o=i[1],c=i[3],l=i[5],d=0,g=0,u=1,p=1/(s*(c*u-l*g)-a*(o*u-l*d)+n*(o*g-c*d)),f=e.getPixels("x"),m=r.getPixels("y");t.translate(f,m),t.transform(p*(c*u-l*g),p*(l*d-o*u),p*(n*g-a*u),p*(s*u-n*d),p*(a*l-n*c),p*(n*o-s*l)),t.translate(-f,-m)}applyToPoint(t){t.applyTransform(this.matrix)}constructor(t,e,r){this.type="matrix",this.matrix=bi(e),this.originX=r[0],this.originY=r[1]}}class Cr extends Tr{constructor(t,e,r){super(t,e,r),this.type="skew",this.angle=new A(t,"angle",e)}}class Di extends Cr{constructor(t,e,r){super(t,e,r),this.type="skewX",this.matrix=[1,0,Math.tan(this.angle.getRadians()),1,0,0]}}class Bi extends Cr{constructor(t,e,r){super(t,e,r),this.type="skewY",this.matrix=[1,Math.tan(this.angle.getRadians()),0,1,0,0]}}function $i(h){return $t(h).trim().replace(/\)([a-zA-Z])/g,") $1").replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/)}function zi(h){const[t="",e=""]=h.split("(");return[t.trim(),e.trim().replace(")","")]}class kt{static fromElement(t,e){const r=e.getStyle("transform",!1,!0);if(r.hasValue()){const[i,s=i]=e.getStyle("transform-origin",!1,!0).split();if(i&&s){const a=[i,s];return new kt(t,r.getString(),a)}}return null}apply(t){this.transforms.forEach(e=>e.apply(t))}unapply(t){this.transforms.forEach(e=>e.unapply(t))}applyToPoint(t){this.transforms.forEach(e=>e.applyToPoint(t))}constructor(t,e,r){this.document=t,this.transforms=[],$i(e).forEach(i=>{if(i==="none")return;const[s,a]=zi(i),n=kt.transformTypes[s];n&&this.transforms.push(new n(this.document,a,r))})}}kt.transformTypes={translate:_i,rotate:Ii,scale:Li,matrix:Tr,skewX:Di,skewY:Bi};class j{getAttribute(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const r=this.attributes[t];if(!r&&e){const i=new A(this.document,t,"");return this.attributes[t]=i,i}return r||A.empty(this.document)}getHrefAttribute(){let t;for(const e in this.attributes)if(e==="href"||e.endsWith(":href")){t=this.attributes[e];break}return t||A.empty(this.document)}getStyle(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const i=this.styles[t];if(i)return i;const s=this.getAttribute(t);if(s.hasValue())return this.styles[t]=s,s;if(!r){const{parent:a}=this;if(a){const n=a.getStyle(t);if(n.hasValue())return n}}if(e){const a=new A(this.document,t,"");return this.styles[t]=a,a}return A.empty(this.document)}render(t){if(!(this.getStyle("display").getString()==="none"||this.getStyle("visibility").getString()==="hidden")){if(t.save(),this.getStyle("mask").hasValue()){const e=this.getStyle("mask").getDefinition();e&&(this.applyEffects(t),e.apply(t,this))}else if(this.getStyle("filter").getValue("none")!=="none"){const e=this.getStyle("filter").getDefinition();e&&(this.applyEffects(t),e.apply(t,this))}else this.setContext(t),this.renderChildren(t),this.clearContext(t);t.restore()}}setContext(t){}applyEffects(t){const e=kt.fromElement(this.document,this);e&&e.apply(t);const r=this.getStyle("clip-path",!1,!0);if(r.hasValue()){const i=r.getDefinition();i&&i.apply(t)}}clearContext(t){}renderChildren(t){this.children.forEach(e=>{e.render(t)})}addChild(t){const e=t instanceof j?t:this.document.createElement(t);e.parent=this,j.ignoreChildTypes.includes(e.type)||this.children.push(e)}matchesSelector(t){var e;const{node:r}=this;if(typeof r.matches=="function")return r.matches(t);const i=(e=r.getAttribute)===null||e===void 0?void 0:e.call(r,"class");return!i||i===""?!1:i.split(" ").some(s=>".".concat(s)===t)}addStylesFromStyleDefinition(){const{styles:t,stylesSpecificity:e}=this.document;let r;for(const i in t)if(!i.startsWith("@")&&this.matchesSelector(i)){const s=t[i],a=e[i];if(s)for(const n in s){let o=this.stylesSpecificity[n];typeof o>"u"&&(o="000"),a&&a>=o&&(r=s[n],r&&(this.styles[n]=r),this.stylesSpecificity[n]=a)}}}removeStyles(t,e){return e.reduce((r,i)=>{const s=t.getStyle(i);if(!s.hasValue())return r;const a=s.getString();return s.setValue(""),[...r,[i,a]]},[])}restoreStyles(t,e){e.forEach(r=>{let[i,s]=r;t.getStyle(i,!0).setValue(s)})}isFirstChild(){var t;return((t=this.parent)===null||t===void 0?void 0:t.children.indexOf(this))===0}constructor(t,e,r=!1){if(this.document=t,this.node=e,this.captureTextNodes=r,this.type="",this.attributes={},this.styles={},this.stylesSpecificity={},this.animationFrozen=!1,this.animationFrozenValue="",this.parent=null,this.children=[],!e||e.nodeType!==1)return;Array.from(e.attributes).forEach(a=>{const n=wi(a.nodeName);this.attributes[n]=new A(t,n,a.value)}),this.addStylesFromStyleDefinition(),this.getAttribute("style").hasValue()&&this.getAttribute("style").getString().split(";").map(a=>a.trim()).forEach(a=>{if(!a)return;const[n,o]=a.split(":").map(c=>c.trim());n&&(this.styles[n]=new A(t,n,o))});const{definitions:i}=t,s=this.getAttribute("id");s.hasValue()&&(i[s.getString()]||(i[s.getString()]=this)),Array.from(e.childNodes).forEach(a=>{if(a.nodeType===1)this.addChild(a);else if(r&&(a.nodeType===3||a.nodeType===4)){const n=t.createTextNode(a);n.getText().length>0&&this.addChild(n)}})}}j.ignoreChildTypes=["title"];class Fi extends j{constructor(t,e,r){super(t,e,r)}}function Ui(h){const t=h.trim();return/^('|")/.test(t)?t:'"'.concat(t,'"')}function Hi(h){return typeof process>"u"?h:h.trim().split(",").map(Ui).join(",")}function Xi(h){if(!h)return"";const t=h.trim().toLowerCase();switch(t){case"normal":case"italic":case"oblique":case"inherit":case"initial":case"unset":return t;default:return/^oblique\s+(-|)\d+deg$/.test(t)?t:""}}function Yi(h){if(!h)return"";const t=h.trim().toLowerCase();switch(t){case"normal":case"bold":case"lighter":case"bolder":case"inherit":case"initial":case"unset":return t;default:return/^[\d.]+$/.test(t)?t:""}}class it{static parse(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",e=arguments.length>1?arguments[1]:void 0,r="",i="",s="",a="",n="";const o=$t(t).trim().split(" "),c={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1};return o.forEach(l=>{switch(!0){case(!c.fontStyle&&it.styles.includes(l)):l!=="inherit"&&(r=l),c.fontStyle=!0;break;case(!c.fontVariant&&it.variants.includes(l)):l!=="inherit"&&(i=l),c.fontStyle=!0,c.fontVariant=!0;break;case(!c.fontWeight&&it.weights.includes(l)):l!=="inherit"&&(s=l),c.fontStyle=!0,c.fontVariant=!0,c.fontWeight=!0;break;case!c.fontSize:l!=="inherit"&&(a=l.split("/")[0]||""),c.fontStyle=!0,c.fontVariant=!0,c.fontWeight=!0,c.fontSize=!0;break;default:l!=="inherit"&&(n+=l)}}),new it(r,i,s,a,n,e)}toString(){return[Xi(this.fontStyle),this.fontVariant,Yi(this.fontWeight),this.fontSize,Hi(this.fontFamily)].join(" ").trim()}constructor(t,e,r,i,s,a){const n=a?typeof a=="string"?it.parse(a):a:{};this.fontFamily=s||n.fontFamily,this.fontSize=i||n.fontSize,this.fontStyle=t||n.fontStyle,this.fontWeight=r||n.fontWeight,this.fontVariant=e||n.fontVariant}}it.styles="normal|italic|oblique|inherit";it.variants="normal|small-caps|inherit";it.weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit";class gt{get x(){return this.x1}get y(){return this.y1}get width(){return this.x2-this.x1}get height(){return this.y2-this.y1}addPoint(t,e){typeof t<"u"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=t,this.x2=t),t<this.x1&&(this.x1=t),t>this.x2&&(this.x2=t)),typeof e<"u"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=e,this.y2=e),e<this.y1&&(this.y1=e),e>this.y2&&(this.y2=e))}addX(t){this.addPoint(t,0)}addY(t){this.addPoint(0,t)}addBoundingBox(t){if(!t)return;const{x1:e,y1:r,x2:i,y2:s}=t;this.addPoint(e,r),this.addPoint(i,s)}sumCubic(t,e,r,i,s){return Math.pow(1-t,3)*e+3*Math.pow(1-t,2)*t*r+3*(1-t)*Math.pow(t,2)*i+Math.pow(t,3)*s}bezierCurveAdd(t,e,r,i,s){const a=6*e-12*r+6*i,n=-3*e+9*r-9*i+3*s,o=3*r-3*e;if(n===0){if(a===0)return;const g=-o/a;0<g&&g<1&&(t?this.addX(this.sumCubic(g,e,r,i,s)):this.addY(this.sumCubic(g,e,r,i,s)));return}const c=Math.pow(a,2)-4*o*n;if(c<0)return;const l=(-a+Math.sqrt(c))/(2*n);0<l&&l<1&&(t?this.addX(this.sumCubic(l,e,r,i,s)):this.addY(this.sumCubic(l,e,r,i,s)));const d=(-a-Math.sqrt(c))/(2*n);0<d&&d<1&&(t?this.addX(this.sumCubic(d,e,r,i,s)):this.addY(this.sumCubic(d,e,r,i,s)))}addBezierCurve(t,e,r,i,s,a,n,o){this.addPoint(t,e),this.addPoint(n,o),this.bezierCurveAdd(!0,t,r,s,n),this.bezierCurveAdd(!1,e,i,a,o)}addQuadraticCurve(t,e,r,i,s,a){const n=t+.6666666666666666*(r-t),o=e+2/3*(i-e),c=n+1/3*(s-t),l=o+1/3*(a-e);this.addBezierCurve(t,e,n,c,o,l,s,a)}isPointInBox(t,e){const{x1:r,y1:i,x2:s,y2:a}=this;return r<=t&&t<=s&&i<=e&&e<=a}constructor(t=Number.NaN,e=Number.NaN,r=Number.NaN,i=Number.NaN){this.x1=t,this.y1=e,this.x2=r,this.y2=i,this.addPoint(t,e),this.addPoint(r,i)}}class Vt extends j{calculateOpacity(){let t=1,e=this;for(;e;){const r=e.getStyle("opacity",!1,!0);r.hasValue(!0)&&(t*=r.getNumber()),e=e.parent}return t}setContext(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(!e){const r=this.getStyle("fill"),i=this.getStyle("fill-opacity"),s=this.getStyle("stroke"),a=this.getStyle("stroke-opacity");if(r.isUrlDefinition()){const u=r.getFillStyleDefinition(this,i);u&&(t.fillStyle=u)}else if(r.hasValue()){r.getString()==="currentColor"&&r.setValue(this.getStyle("color").getColor());const u=r.getColor();u!=="inherit"&&(t.fillStyle=u==="none"?"rgba(0,0,0,0)":u)}if(i.hasValue()){const u=new A(this.document,"fill",t.fillStyle).addOpacity(i).getColor();t.fillStyle=u}if(s.isUrlDefinition()){const u=s.getFillStyleDefinition(this,a);u&&(t.strokeStyle=u)}else if(s.hasValue()){s.getString()==="currentColor"&&s.setValue(this.getStyle("color").getColor());const u=s.getString();u!=="inherit"&&(t.strokeStyle=u==="none"?"rgba(0,0,0,0)":u)}if(a.hasValue()){const u=new A(this.document,"stroke",t.strokeStyle).addOpacity(a).getString();t.strokeStyle=u}const n=this.getStyle("stroke-width");if(n.hasValue()){const u=n.getPixels();t.lineWidth=u||Dt}const o=this.getStyle("stroke-linecap"),c=this.getStyle("stroke-linejoin"),l=this.getStyle("stroke-miterlimit"),d=this.getStyle("stroke-dasharray"),g=this.getStyle("stroke-dashoffset");if(o.hasValue()&&(t.lineCap=o.getString()),c.hasValue()&&(t.lineJoin=c.getString()),l.hasValue()&&(t.miterLimit=l.getNumber()),d.hasValue()&&d.getString()!=="none"){const u=ht(d.getString());typeof t.setLineDash<"u"?t.setLineDash(u):typeof t.webkitLineDash<"u"?t.webkitLineDash=u:typeof t.mozDash<"u"&&!(u.length===1&&u[0]===0)&&(t.mozDash=u);const p=g.getPixels();typeof t.lineDashOffset<"u"?t.lineDashOffset=p:typeof t.webkitLineDashOffset<"u"?t.webkitLineDashOffset=p:typeof t.mozDashOffset<"u"&&(t.mozDashOffset=p)}}if(this.modifiedEmSizeStack=!1,typeof t.font<"u"){const r=this.getStyle("font"),i=this.getStyle("font-style"),s=this.getStyle("font-variant"),a=this.getStyle("font-weight"),n=this.getStyle("font-size"),o=this.getStyle("font-family"),c=new it(i.getString(),s.getString(),a.getString(),n.hasValue()?"".concat(n.getPixels(!0),"px"):"",o.getString(),it.parse(r.getString(),t.font));i.setValue(c.fontStyle),s.setValue(c.fontVariant),a.setValue(c.fontWeight),n.setValue(c.fontSize),o.setValue(c.fontFamily),t.font=c.toString(),n.isPixels()&&(this.document.emSize=n.getPixels(),this.modifiedEmSizeStack=!0)}e||(this.applyEffects(t),t.globalAlpha=this.calculateOpacity())}clearContext(t){super.clearContext(t),this.modifiedEmSizeStack&&this.document.popEmSize()}constructor(...t){super(...t),this.modifiedEmSizeStack=!1}}class At extends Vt{setContext(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;super.setContext(t,e);const r=this.getStyle("dominant-baseline").getTextBaseline()||this.getStyle("alignment-baseline").getTextBaseline();r&&(t.textBaseline=r)}initializeCoordinates(){this.x=0,this.y=0,this.leafTexts=[],this.textChunkStart=0,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY}getBoundingBox(t){if(this.type!=="text")return this.getTElementBoundingBox(t);this.initializeCoordinates(),this.adjustChildCoordinatesRecursive(t);let e=null;return this.children.forEach((r,i)=>{const s=this.getChildBoundingBox(t,this,this,i);e?e.addBoundingBox(s):e=s}),e}getFontSize(){const{document:t,parent:e}=this,r=it.parse(t.ctx.font).fontSize;return e.getStyle("font-size").getNumber(r)}getTElementBoundingBox(t){const e=this.getFontSize();return new gt(this.x,this.y-e,this.x+this.measureText(t),this.y)}getGlyph(t,e,r){const i=e[r];let s;if(t.isArabic){var a;const n=e.length,o=e[r-1],c=e[r+1];let l="isolated";(r===0||o===" ")&&r<n-1&&c!==" "&&(l="terminal"),r>0&&o!==" "&&r<n-1&&c!==" "&&(l="medial"),r>0&&o!==" "&&(r===n-1||c===" ")&&(l="initial"),s=((a=t.arabicGlyphs[i])===null||a===void 0?void 0:a[l])||t.glyphs[i]}else s=t.glyphs[i];return s||(s=t.missingGlyph),s}getText(){return""}getTextFromNode(t){const e=t||this.node,r=Array.from(e.parentNode.childNodes),i=r.indexOf(e),s=r.length-1;let a=$t(e.textContent||"");return i===0&&(a=yi(a)),i===s&&(a=xi(a)),a}renderChildren(t){if(this.type!=="text"){this.renderTElementChildren(t);return}this.initializeCoordinates(),this.adjustChildCoordinatesRecursive(t),this.children.forEach((r,i)=>{this.renderChild(t,this,this,i)});const{mouse:e}=this.document.screen;e.isWorking()&&e.checkBoundingBox(this,this.getBoundingBox(t))}renderTElementChildren(t){const{document:e,parent:r}=this,i=this.getText(),s=r.getStyle("font-family").getDefinition();if(s){const{unitsPerEm:o}=s.fontFace,c=it.parse(e.ctx.font),l=r.getStyle("font-size").getNumber(c.fontSize),d=r.getStyle("font-style").getString(c.fontStyle),g=l/o,u=s.isRTL?i.split("").reverse().join(""):i,p=ht(r.getAttribute("dx").getString()),f=u.length;for(let m=0;m<f;m++){const y=this.getGlyph(s,u,m);t.translate(this.x,this.y),t.scale(g,-g);const v=t.lineWidth;t.lineWidth=t.lineWidth*o/l,d==="italic"&&t.transform(1,0,.4,1,0,0),y.render(t),d==="italic"&&t.transform(1,0,-.4,1,0,0),t.lineWidth=v,t.scale(1/g,-1/g),t.translate(-this.x,-this.y),this.x+=l*(y.horizAdvX||s.horizAdvX)/o,typeof p[m]<"u"&&!isNaN(p[m])&&(this.x+=p[m])}return}const{x:a,y:n}=this;t.fillStyle&&t.fillText(i,a,n),t.strokeStyle&&t.strokeText(i,a,n)}applyAnchoring(){if(this.textChunkStart>=this.leafTexts.length)return;const t=this.leafTexts[this.textChunkStart],e=t.getStyle("text-anchor").getString("start"),r=!1;let i=0;e==="start"&&!r||e==="end"&&r?i=t.x-this.minX:e==="end"&&!r||e==="start"&&r?i=t.x-this.maxX:i=t.x-(this.minX+this.maxX)/2;for(let s=this.textChunkStart;s<this.leafTexts.length;s++)this.leafTexts[s].x+=i;this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.textChunkStart=this.leafTexts.length}adjustChildCoordinatesRecursive(t){this.children.forEach((e,r)=>{this.adjustChildCoordinatesRecursiveCore(t,this,this,r)}),this.applyAnchoring()}adjustChildCoordinatesRecursiveCore(t,e,r,i){const s=r.children[i];s.children.length>0?s.children.forEach((a,n)=>{e.adjustChildCoordinatesRecursiveCore(t,e,s,n)}):this.adjustChildCoordinates(t,e,r,i)}adjustChildCoordinates(t,e,r,i){const s=r.children[i];if(typeof s.measureText!="function")return s;t.save(),s.setContext(t,!0);const a=s.getAttribute("x"),n=s.getAttribute("y"),o=s.getAttribute("dx"),c=s.getAttribute("dy"),l=s.getStyle("font-family").getDefinition(),d=!!(l!=null&&l.isRTL);i===0&&(a.hasValue()||a.setValue(s.getInheritedAttribute("x")),n.hasValue()||n.setValue(s.getInheritedAttribute("y")),o.hasValue()||o.setValue(s.getInheritedAttribute("dx")),c.hasValue()||c.setValue(s.getInheritedAttribute("dy")));const g=s.measureText(t);return d&&(e.x-=g),a.hasValue()?(e.applyAnchoring(),s.x=a.getPixels("x"),o.hasValue()&&(s.x+=o.getPixels("x"))):(o.hasValue()&&(e.x+=o.getPixels("x")),s.x=e.x),e.x=s.x,d||(e.x+=g),n.hasValue()?(s.y=n.getPixels("y"),c.hasValue()&&(s.y+=c.getPixels("y"))):(c.hasValue()&&(e.y+=c.getPixels("y")),s.y=e.y),e.y=s.y,e.leafTexts.push(s),e.minX=Math.min(e.minX,s.x,s.x+g),e.maxX=Math.max(e.maxX,s.x,s.x+g),s.clearContext(t),t.restore(),s}getChildBoundingBox(t,e,r,i){const s=r.children[i];if(typeof s.getBoundingBox!="function")return null;const a=s.getBoundingBox(t);return a&&s.children.forEach((n,o)=>{const c=e.getChildBoundingBox(t,e,s,o);a.addBoundingBox(c)}),a}renderChild(t,e,r,i){const s=r.children[i];s.render(t),s.children.forEach((a,n)=>{e.renderChild(t,e,s,n)})}measureText(t){const{measureCache:e}=this;if(~e)return e;const r=this.getText(),i=this.measureTargetText(t,r);return this.measureCache=i,i}measureTargetText(t,e){if(!e.length)return 0;const{parent:r}=this,i=r.getStyle("font-family").getDefinition();if(i){const a=this.getFontSize(),n=i.isRTL?e.split("").reverse().join(""):e,o=ht(r.getAttribute("dx").getString()),c=n.length;let l=0;for(let d=0;d<c;d++){const g=this.getGlyph(i,n,d);l+=(g.horizAdvX||i.horizAdvX)*a/i.fontFace.unitsPerEm,typeof o[d]<"u"&&!isNaN(o[d])&&(l+=o[d])}return l}if(!t.measureText)return e.length*10;t.save(),this.setContext(t,!0);const{width:s}=t.measureText(e);return this.clearContext(t),t.restore(),s}getInheritedAttribute(t){let e=this;for(;e instanceof At&&e.isFirstChild()&&e.parent;){const r=e.parent.getAttribute(t);if(r.hasValue(!0))return r.getString("0");e=e.parent}return null}constructor(t,e,r){super(t,e,new.target===At?!0:r),this.type="text",this.x=0,this.y=0,this.leafTexts=[],this.textChunkStart=0,this.minX=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.measureCache=-1}}class ae extends At{getText(){return this.text}constructor(t,e,r){super(t,e,new.target===ae?!0:r),this.type="tspan",this.text=this.children.length>0?"":this.getTextFromNode()}}class qi extends ae{constructor(...t){super(...t),this.type="textNode"}}class O extends b{reset(){this.i=-1,this.command=null,this.previousCommand=null,this.start=new Q(0,0),this.control=new Q(0,0),this.current=new Q(0,0),this.points=[],this.angles=[]}isEnd(){const{i:t,commands:e}=this;return t>=e.length-1}next(){const t=this.commands[++this.i];return this.previousCommand=this.command,this.command=t,t}getPoint(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"x",e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"y";const r=new Q(this.command[t],this.command[e]);return this.makeAbsolute(r)}getAsControlPoint(t,e){const r=this.getPoint(t,e);return this.control=r,r}getAsCurrentPoint(t,e){const r=this.getPoint(t,e);return this.current=r,r}getReflectedControlPoint(){const t=this.previousCommand.type;if(t!==b.CURVE_TO&&t!==b.SMOOTH_CURVE_TO&&t!==b.QUAD_TO&&t!==b.SMOOTH_QUAD_TO)return this.current;const{current:{x:e,y:r},control:{x:i,y:s}}=this;return new Q(2*e-i,2*r-s)}makeAbsolute(t){if(this.command.relative){const{x:e,y:r}=this.current;t.x+=e,t.y+=r}return t}addMarker(t,e,r){const{points:i,angles:s}=this;r&&s.length>0&&!s[s.length-1]&&(s[s.length-1]=i[i.length-1].angleTo(r)),this.addMarkerAngle(t,e?e.angleTo(t):null)}addMarkerAngle(t,e){this.points.push(t),this.angles.push(e)}getMarkerPoints(){return this.points}getMarkerAngles(){const{angles:t}=this,e=t.length;for(let r=0;r<e;r++)if(!t[r]){for(let i=r+1;i<e;i++)if(t[i]){t[r]=t[i];break}}return t}constructor(t){super(t.replace(/([+\-.])\s+/gm,"$1").replace(/[^MmZzLlHhVvCcSsQqTtAae\d\s.,+-].*/g,"")),this.control=new Q(0,0),this.start=new Q(0,0),this.current=new Q(0,0),this.command=null,this.commands=this.commands,this.i=-1,this.previousCommand=null,this.points=[],this.angles=[]}}class X extends Vt{path(t){const{pathParser:e}=this,r=new gt;for(e.reset(),t&&t.beginPath();!e.isEnd();)switch(e.next().type){case O.MOVE_TO:this.pathM(t,r);break;case O.LINE_TO:this.pathL(t,r);break;case O.HORIZ_LINE_TO:this.pathH(t,r);break;case O.VERT_LINE_TO:this.pathV(t,r);break;case O.CURVE_TO:this.pathC(t,r);break;case O.SMOOTH_CURVE_TO:this.pathS(t,r);break;case O.QUAD_TO:this.pathQ(t,r);break;case O.SMOOTH_QUAD_TO:this.pathT(t,r);break;case O.ARC:this.pathA(t,r);break;case O.CLOSE_PATH:this.pathZ(t,r);break}return r}getBoundingBox(t){return this.path()}getMarkers(){const{pathParser:t}=this,e=t.getMarkerPoints(),r=t.getMarkerAngles();return e.map((i,s)=>[i,r[s]])}renderChildren(t){this.path(t),this.document.screen.mouse.checkPath(this,t);const e=this.getStyle("fill-rule");t.fillStyle!==""&&(e.getString("inherit")!=="inherit"?t.fill(e.getString()):t.fill()),t.strokeStyle!==""&&(this.getAttribute("vector-effect").getString()==="non-scaling-stroke"?(t.save(),t.setTransform(1,0,0,1,0,0),t.stroke(),t.restore()):t.stroke());const r=this.getMarkers();if(r){const i=r.length-1,s=this.getStyle("marker-start"),a=this.getStyle("marker-mid"),n=this.getStyle("marker-end");if(s.isUrlDefinition()){const o=s.getDefinition(),[c,l]=r[0];o.render(t,c,l)}if(a.isUrlDefinition()){const o=a.getDefinition();for(let c=1;c<i;c++){const[l,d]=r[c];o.render(t,l,d)}}if(n.isUrlDefinition()){const o=n.getDefinition(),[c,l]=r[i];o.render(t,c,l)}}}static pathM(t){const e=t.getAsCurrentPoint();return t.start=t.current,{point:e}}pathM(t,e){const{pathParser:r}=this,{point:i}=X.pathM(r),{x:s,y:a}=i;r.addMarker(i),e.addPoint(s,a),t&&t.moveTo(s,a)}static pathL(t){const{current:e}=t,r=t.getAsCurrentPoint();return{current:e,point:r}}pathL(t,e){const{pathParser:r}=this,{current:i,point:s}=X.pathL(r),{x:a,y:n}=s;r.addMarker(s,i),e.addPoint(a,n),t&&t.lineTo(a,n)}static pathH(t){const{current:e,command:r}=t,i=new Q((r.relative?e.x:0)+r.x,e.y);return t.current=i,{current:e,point:i}}pathH(t,e){const{pathParser:r}=this,{current:i,point:s}=X.pathH(r),{x:a,y:n}=s;r.addMarker(s,i),e.addPoint(a,n),t&&t.lineTo(a,n)}static pathV(t){const{current:e,command:r}=t,i=new Q(e.x,(r.relative?e.y:0)+r.y);return t.current=i,{current:e,point:i}}pathV(t,e){const{pathParser:r}=this,{current:i,point:s}=X.pathV(r),{x:a,y:n}=s;r.addMarker(s,i),e.addPoint(a,n),t&&t.lineTo(a,n)}static pathC(t){const{current:e}=t,r=t.getPoint("x1","y1"),i=t.getAsControlPoint("x2","y2"),s=t.getAsCurrentPoint();return{current:e,point:r,controlPoint:i,currentPoint:s}}pathC(t,e){const{pathParser:r}=this,{current:i,point:s,controlPoint:a,currentPoint:n}=X.pathC(r);r.addMarker(n,a,s),e.addBezierCurve(i.x,i.y,s.x,s.y,a.x,a.y,n.x,n.y),t&&t.bezierCurveTo(s.x,s.y,a.x,a.y,n.x,n.y)}static pathS(t){const{current:e}=t,r=t.getReflectedControlPoint(),i=t.getAsControlPoint("x2","y2"),s=t.getAsCurrentPoint();return{current:e,point:r,controlPoint:i,currentPoint:s}}pathS(t,e){const{pathParser:r}=this,{current:i,point:s,controlPoint:a,currentPoint:n}=X.pathS(r);r.addMarker(n,a,s),e.addBezierCurve(i.x,i.y,s.x,s.y,a.x,a.y,n.x,n.y),t&&t.bezierCurveTo(s.x,s.y,a.x,a.y,n.x,n.y)}static pathQ(t){const{current:e}=t,r=t.getAsControlPoint("x1","y1"),i=t.getAsCurrentPoint();return{current:e,controlPoint:r,currentPoint:i}}pathQ(t,e){const{pathParser:r}=this,{current:i,controlPoint:s,currentPoint:a}=X.pathQ(r);r.addMarker(a,s,s),e.addQuadraticCurve(i.x,i.y,s.x,s.y,a.x,a.y),t&&t.quadraticCurveTo(s.x,s.y,a.x,a.y)}static pathT(t){const{current:e}=t,r=t.getReflectedControlPoint();t.control=r;const i=t.getAsCurrentPoint();return{current:e,controlPoint:r,currentPoint:i}}pathT(t,e){const{pathParser:r}=this,{current:i,controlPoint:s,currentPoint:a}=X.pathT(r);r.addMarker(a,s,s),e.addQuadraticCurve(i.x,i.y,s.x,s.y,a.x,a.y),t&&t.quadraticCurveTo(s.x,s.y,a.x,a.y)}static pathA(t){const{current:e,command:r}=t;let{rX:i,rY:s,xRot:a,lArcFlag:n,sweepFlag:o}=r;const c=a*(Math.PI/180),l=t.getAsCurrentPoint(),d=new Q(Math.cos(c)*(e.x-l.x)/2+Math.sin(c)*(e.y-l.y)/2,-Math.sin(c)*(e.x-l.x)/2+Math.cos(c)*(e.y-l.y)/2),g=Math.pow(d.x,2)/Math.pow(i,2)+Math.pow(d.y,2)/Math.pow(s,2);g>1&&(i*=Math.sqrt(g),s*=Math.sqrt(g));let u=(n===o?-1:1)*Math.sqrt((Math.pow(i,2)*Math.pow(s,2)-Math.pow(i,2)*Math.pow(d.y,2)-Math.pow(s,2)*Math.pow(d.x,2))/(Math.pow(i,2)*Math.pow(d.y,2)+Math.pow(s,2)*Math.pow(d.x,2)));isNaN(u)&&(u=0);const p=new Q(u*i*d.y/s,u*-s*d.x/i),f=new Q((e.x+l.x)/2+Math.cos(c)*p.x-Math.sin(c)*p.y,(e.y+l.y)/2+Math.sin(c)*p.x+Math.cos(c)*p.y),m=Ze([1,0],[(d.x-p.x)/i,(d.y-p.y)/s]),y=[(d.x-p.x)/i,(d.y-p.y)/s],v=[(-d.x-p.x)/i,(-d.y-p.y)/s];let x=Ze(y,v);return Pe(y,v)<=-1&&(x=Math.PI),Pe(y,v)>=1&&(x=0),{currentPoint:l,rX:i,rY:s,sweepFlag:o,xAxisRotation:c,centp:f,a1:m,ad:x}}pathA(t,e){const{pathParser:r}=this,{currentPoint:i,rX:s,rY:a,sweepFlag:n,xAxisRotation:o,centp:c,a1:l,ad:d}=X.pathA(r),g=1-n?1:-1,u=l+g*(d/2),p=new Q(c.x+s*Math.cos(u),c.y+a*Math.sin(u));if(r.addMarkerAngle(p,u-g*Math.PI/2),r.addMarkerAngle(i,u-g*Math.PI),e.addPoint(i.x,i.y),t&&!isNaN(l)&&!isNaN(d)){const f=s>a?s:a,m=s>a?1:s/a,y=s>a?a/s:1;t.translate(c.x,c.y),t.rotate(o),t.scale(m,y),t.arc(0,0,f,l,l+d,!!(1-n)),t.scale(1/m,1/y),t.rotate(-o),t.translate(-c.x,-c.y)}}static pathZ(t){t.current=t.start}pathZ(t,e){X.pathZ(this.pathParser),t&&e.x1!==e.x2&&e.y1!==e.y2&&t.closePath()}constructor(t,e,r){super(t,e,r),this.type="path",this.pathParser=new O(this.getAttribute("d").getString())}}class jt extends Vt{setContext(t){var e;const{document:r}=this,{screen:i,window:s}=r,a=t.canvas;if(i.setDefaults(t),"style"in a&&typeof t.font<"u"&&s&&typeof s.getComputedStyle<"u"){t.font=s.getComputedStyle(a).getPropertyValue("font");const v=new A(r,"fontSize",it.parse(t.font).fontSize);v.hasValue()&&(r.rootEmSize=v.getPixels("y"),r.emSize=r.rootEmSize)}this.getAttribute("x").hasValue()||this.getAttribute("x",!0).setValue(0),this.getAttribute("y").hasValue()||this.getAttribute("y",!0).setValue(0);let{width:n,height:o}=i.viewPort;this.getStyle("width").hasValue()||this.getStyle("width",!0).setValue("100%"),this.getStyle("height").hasValue()||this.getStyle("height",!0).setValue("100%"),this.getStyle("color").hasValue()||this.getStyle("color",!0).setValue("black");const c=this.getAttribute("refX"),l=this.getAttribute("refY"),d=this.getAttribute("viewBox"),g=d.hasValue()?ht(d.getString()):null,u=!this.root&&this.getStyle("overflow").getValue("hidden")!=="visible";let p=0,f=0,m=0,y=0;g&&(p=g[0],f=g[1]),this.root||(n=this.getStyle("width").getPixels("x"),o=this.getStyle("height").getPixels("y"),this.type==="marker"&&(m=p,y=f,p=0,f=0)),i.viewPort.setCurrent(n,o),this.node&&(!this.parent||((e=this.node.parentNode)===null||e===void 0?void 0:e.nodeName)==="foreignObject")&&this.getStyle("transform",!1,!0).hasValue()&&!this.getStyle("transform-origin",!1,!0).hasValue()&&this.getStyle("transform-origin",!0,!0).setValue("50% 50%"),super.setContext(t),t.translate(this.getAttribute("x").getPixels("x"),this.getAttribute("y").getPixels("y")),g&&(n=g[2],o=g[3]),r.setViewBox({ctx:t,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:i.viewPort.width,desiredWidth:n,height:i.viewPort.height,desiredHeight:o,minX:p,minY:f,refX:c.getValue(),refY:l.getValue(),clip:u,clipX:m,clipY:y}),g&&(i.viewPort.removeCurrent(),i.viewPort.setCurrent(n,o))}clearContext(t){super.clearContext(t),this.document.screen.viewPort.removeCurrent()}resize(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const i=this.getAttribute("width",!0),s=this.getAttribute("height",!0),a=this.getAttribute("viewBox"),n=this.getAttribute("style"),o=i.getNumber(0),c=s.getNumber(0);if(r)if(typeof r=="string")this.getAttribute("preserveAspectRatio",!0).setValue(r);else{const l=this.getAttribute("preserveAspectRatio");l.hasValue()&&l.setValue(l.getString().replace(/^\s*(\S.*\S)\s*$/,"$1"))}if(i.setValue(t),s.setValue(e),a.hasValue()||a.setValue("0 0 ".concat(o||t," ").concat(c||e)),n.hasValue()){const l=this.getStyle("width"),d=this.getStyle("height");l.hasValue()&&l.setValue("".concat(t,"px")),d.hasValue()&&d.setValue("".concat(e,"px"))}}constructor(...t){super(...t),this.type="svg",this.root=!1}}class Pr extends X{path(t){const e=this.getAttribute("x").getPixels("x"),r=this.getAttribute("y").getPixels("y"),i=this.getStyle("width",!1,!0).getPixels("x"),s=this.getStyle("height",!1,!0).getPixels("y"),a=this.getAttribute("rx"),n=this.getAttribute("ry");let o=a.getPixels("x"),c=n.getPixels("y");if(a.hasValue()&&!n.hasValue()&&(c=o),n.hasValue()&&!a.hasValue()&&(o=c),o=Math.min(o,i/2),c=Math.min(c,s/2),t){const l=4*((Math.sqrt(2)-1)/3);t.beginPath(),s>0&&i>0&&(t.moveTo(e+o,r),t.lineTo(e+i-o,r),t.bezierCurveTo(e+i-o+l*o,r,e+i,r+c-l*c,e+i,r+c),t.lineTo(e+i,r+s-c),t.bezierCurveTo(e+i,r+s-c+l*c,e+i-o+l*o,r+s,e+i-o,r+s),t.lineTo(e+o,r+s),t.bezierCurveTo(e+o-l*o,r+s,e,r+s-c+l*c,e,r+s-c),t.lineTo(e,r+c),t.bezierCurveTo(e,r+c-l*c,e+o-l*o,r,e+o,r),t.closePath())}return new gt(e,r,e+i,r+s)}getMarkers(){return null}constructor(...t){super(...t),this.type="rect"}}class Wi extends X{path(t){const e=this.getAttribute("cx").getPixels("x"),r=this.getAttribute("cy").getPixels("y"),i=this.getAttribute("r").getPixels();return t&&i>0&&(t.beginPath(),t.arc(e,r,i,0,Math.PI*2,!1),t.closePath()),new gt(e-i,r-i,e+i,r+i)}getMarkers(){return null}constructor(...t){super(...t),this.type="circle"}}class ji extends X{path(t){const e=4*((Math.sqrt(2)-1)/3),r=this.getAttribute("rx").getPixels("x"),i=this.getAttribute("ry").getPixels("y"),s=this.getAttribute("cx").getPixels("x"),a=this.getAttribute("cy").getPixels("y");return t&&r>0&&i>0&&(t.beginPath(),t.moveTo(s+r,a),t.bezierCurveTo(s+r,a+e*i,s+e*r,a+i,s,a+i),t.bezierCurveTo(s-e*r,a+i,s-r,a+e*i,s-r,a),t.bezierCurveTo(s-r,a-e*i,s-e*r,a-i,s,a-i),t.bezierCurveTo(s+e*r,a-i,s+r,a-e*i,s+r,a),t.closePath()),new gt(s-r,a-i,s+r,a+i)}getMarkers(){return null}constructor(...t){super(...t),this.type="ellipse"}}class Qi extends X{getPoints(){return[new Q(this.getAttribute("x1").getPixels("x"),this.getAttribute("y1").getPixels("y")),new Q(this.getAttribute("x2").getPixels("x"),this.getAttribute("y2").getPixels("y"))]}path(t){const[{x:e,y:r},{x:i,y:s}]=this.getPoints();return t&&(t.beginPath(),t.moveTo(e,r),t.lineTo(i,s)),new gt(e,r,i,s)}getMarkers(){const[t,e]=this.getPoints(),r=t.angleTo(e);return[[t,r],[e,r]]}constructor(...t){super(...t),this.type="line"}}class Or extends X{path(t){const{points:e}=this,[{x:r,y:i}]=e,s=new gt(r,i);return t&&(t.beginPath(),t.moveTo(r,i)),e.forEach(a=>{let{x:n,y:o}=a;s.addPoint(n,o),t&&t.lineTo(n,o)}),s}getMarkers(){const{points:t}=this,e=t.length-1,r=[];return t.forEach((i,s)=>{s!==e&&r.push([i,i.angleTo(t[s+1])])}),r.length>0&&r.push([t[t.length-1],r[r.length-1][1]]),r}constructor(t,e,r){super(t,e,r),this.type="polyline",this.points=[],this.points=Q.parsePath(this.getAttribute("points").getString())}}class Gi extends Or{path(t){const e=super.path(t),[{x:r,y:i}]=this.points;return t&&(t.lineTo(r,i),t.closePath()),e}constructor(...t){super(...t),this.type="polygon"}}class Zi extends j{createPattern(t,e,r){const i=this.getStyle("width").getPixels("x",!0),s=this.getStyle("height").getPixels("y",!0),a=new jt(this.document,null);a.attributes.viewBox=new A(this.document,"viewBox",this.getAttribute("viewBox").getValue()),a.attributes.width=new A(this.document,"width","".concat(i,"px")),a.attributes.height=new A(this.document,"height","".concat(s,"px")),a.attributes.transform=new A(this.document,"transform",this.getAttribute("patternTransform").getValue()),a.children=this.children;const n=this.document.createCanvas(i,s),o=n.getContext("2d"),c=this.getAttribute("x"),l=this.getAttribute("y");c.hasValue()&&l.hasValue()&&o.translate(c.getPixels("x",!0),l.getPixels("y",!0)),r.hasValue()?this.styles["fill-opacity"]=r:Reflect.deleteProperty(this.styles,"fill-opacity");for(let d=-1;d<=1;d++)for(let g=-1;g<=1;g++)o.save(),a.attributes.x=new A(this.document,"x",d*n.width),a.attributes.y=new A(this.document,"y",g*n.height),a.render(o),o.restore();return t.createPattern(n,"repeat")}constructor(...t){super(...t),this.type="pattern"}}class Ji extends j{render(t,e,r){if(!e)return;const{x:i,y:s}=e,a=this.getAttribute("orient").getString("auto"),n=this.getAttribute("markerUnits").getString("strokeWidth");t.translate(i,s),a==="auto"&&t.rotate(r),n==="strokeWidth"&&t.scale(t.lineWidth,t.lineWidth),t.save();const o=new jt(this.document);o.type=this.type,o.attributes.viewBox=new A(this.document,"viewBox",this.getAttribute("viewBox").getValue()),o.attributes.refX=new A(this.document,"refX",this.getAttribute("refX").getValue()),o.attributes.refY=new A(this.document,"refY",this.getAttribute("refY").getValue()),o.attributes.width=new A(this.document,"width",this.getAttribute("markerWidth").getValue()),o.attributes.height=new A(this.document,"height",this.getAttribute("markerHeight").getValue()),o.attributes.overflow=new A(this.document,"overflow",this.getAttribute("overflow").getValue()),o.attributes.fill=new A(this.document,"fill",this.getAttribute("fill").getColor("black")),o.attributes.stroke=new A(this.document,"stroke",this.getAttribute("stroke").getValue("none")),o.children=this.children,o.render(t),t.restore(),n==="strokeWidth"&&t.scale(1/t.lineWidth,1/t.lineWidth),a==="auto"&&t.rotate(-r),t.translate(-i,-s)}constructor(...t){super(...t),this.type="marker"}}class Ki extends j{render(){}constructor(...t){super(...t),this.type="defs"}}class Oe extends Vt{getBoundingBox(t){const e=new gt;return this.children.forEach(r=>{e.addBoundingBox(r.getBoundingBox(t))}),e}constructor(...t){super(...t),this.type="g"}}class Er extends j{getGradientUnits(){return this.getAttribute("gradientUnits").getString("objectBoundingBox")}createGradient(t,e,r){let i=this;this.getHrefAttribute().hasValue()&&(i=this.getHrefAttribute().getDefinition(),this.inheritStopContainer(i));const{stops:s}=i,a=this.getGradient(t,e);if(!a)return this.addParentOpacity(r,s[s.length-1].color);if(s.forEach(n=>{a.addColorStop(n.offset,this.addParentOpacity(r,n.color))}),this.getAttribute("gradientTransform").hasValue()){const{document:n}=this,{MAX_VIRTUAL_PIXELS:o}=xt,{viewPort:c}=n.screen,l=c.getRoot(),d=new Pr(n);d.attributes.x=new A(n,"x",-o/3),d.attributes.y=new A(n,"y",-o/3),d.attributes.width=new A(n,"width",o),d.attributes.height=new A(n,"height",o);const g=new Oe(n);g.attributes.transform=new A(n,"transform",this.getAttribute("gradientTransform").getValue()),g.children=[d];const u=new jt(n);u.attributes.x=new A(n,"x",0),u.attributes.y=new A(n,"y",0),u.attributes.width=new A(n,"width",l.width),u.attributes.height=new A(n,"height",l.height),u.children=[g];const p=n.createCanvas(l.width,l.height),f=p.getContext("2d");return f.fillStyle=a,u.render(f),f.createPattern(p,"no-repeat")}return a}inheritStopContainer(t){this.attributesToInherit.forEach(e=>{!this.getAttribute(e).hasValue()&&t.getAttribute(e).hasValue()&&this.getAttribute(e,!0).setValue(t.getAttribute(e).getValue())})}addParentOpacity(t,e){return t.hasValue()?new A(this.document,"color",e).addOpacity(t).getColor():e}constructor(t,e,r){super(t,e,r),this.attributesToInherit=["gradientUnits"],this.stops=[];const{stops:i,children:s}=this;s.forEach(a=>{a.type==="stop"&&i.push(a)})}}class ts extends Er{getGradient(t,e){const r=this.getGradientUnits()==="objectBoundingBox",i=r?e.getBoundingBox(t):null;if(r&&!i)return null;!this.getAttribute("x1").hasValue()&&!this.getAttribute("y1").hasValue()&&!this.getAttribute("x2").hasValue()&&!this.getAttribute("y2").hasValue()&&(this.getAttribute("x1",!0).setValue(0),this.getAttribute("y1",!0).setValue(0),this.getAttribute("x2",!0).setValue(1),this.getAttribute("y2",!0).setValue(0));const s=r?i.x+i.width*this.getAttribute("x1").getNumber():this.getAttribute("x1").getPixels("x"),a=r?i.y+i.height*this.getAttribute("y1").getNumber():this.getAttribute("y1").getPixels("y"),n=r?i.x+i.width*this.getAttribute("x2").getNumber():this.getAttribute("x2").getPixels("x"),o=r?i.y+i.height*this.getAttribute("y2").getNumber():this.getAttribute("y2").getPixels("y");return s===n&&a===o?null:t.createLinearGradient(s,a,n,o)}constructor(t,e,r){super(t,e,r),this.type="linearGradient",this.attributesToInherit.push("x1","y1","x2","y2")}}class es extends Er{getGradient(t,e){const r=this.getGradientUnits()==="objectBoundingBox",i=e.getBoundingBox(t);if(r&&!i)return null;this.getAttribute("cx").hasValue()||this.getAttribute("cx",!0).setValue("50%"),this.getAttribute("cy").hasValue()||this.getAttribute("cy",!0).setValue("50%"),this.getAttribute("r").hasValue()||this.getAttribute("r",!0).setValue("50%");const s=r?i.x+i.width*this.getAttribute("cx").getNumber():this.getAttribute("cx").getPixels("x"),a=r?i.y+i.height*this.getAttribute("cy").getNumber():this.getAttribute("cy").getPixels("y");let n=s,o=a;this.getAttribute("fx").hasValue()&&(n=r?i.x+i.width*this.getAttribute("fx").getNumber():this.getAttribute("fx").getPixels("x")),this.getAttribute("fy").hasValue()&&(o=r?i.y+i.height*this.getAttribute("fy").getNumber():this.getAttribute("fy").getPixels("y"));const c=r?(i.width+i.height)/2*this.getAttribute("r").getNumber():this.getAttribute("r").getPixels(),l=this.getAttribute("fr").getPixels();return t.createRadialGradient(n,o,l,s,a,c)}constructor(t,e,r){super(t,e,r),this.type="radialGradient",this.attributesToInherit.push("cx","cy","r","fx","fy","fr")}}class rs extends j{constructor(t,e,r){super(t,e,r),this.type="stop";const i=Math.max(0,Math.min(1,this.getAttribute("offset").getNumber())),s=this.getStyle("stop-opacity");let a=this.getStyle("stop-color",!0);a.getString()===""&&a.setValue("#000"),s.hasValue()&&(a=a.addOpacity(s)),this.offset=i,this.color=a.getColor()}}class Ee extends j{getProperty(){const t=this.getAttribute("attributeType").getString(),e=this.getAttribute("attributeName").getString();return t==="CSS"?this.parent.getStyle(e,!0):this.parent.getAttribute(e,!0)}calcValue(){const{initialUnits:t}=this,{progress:e,from:r,to:i}=this.getProgress();let s=r.getNumber()+(i.getNumber()-r.getNumber())*e;return t==="%"&&(s*=100),"".concat(s).concat(t)}update(t){const{parent:e}=this,r=this.getProperty();if(this.initialValue||(this.initialValue=r.getString(),this.initialUnits=r.getUnits()),this.duration>this.maxDuration){const s=this.getAttribute("fill").getString("remove");if(this.getAttribute("repeatCount").getString()==="indefinite"||this.getAttribute("repeatDur").getString()==="indefinite")this.duration=0;else if(s==="freeze"&&!this.frozen)this.frozen=!0,e&&r&&(e.animationFrozen=!0,e.animationFrozenValue=r.getString());else if(s==="remove"&&!this.removed)return this.removed=!0,e&&r&&r.setValue(e.animationFrozen?e.animationFrozenValue:this.initialValue),!0;return!1}this.duration+=t;let i=!1;if(this.begin<this.duration){let s=this.calcValue();const a=this.getAttribute("type");if(a.hasValue()){const n=a.getString();s="".concat(n,"(").concat(s,")")}r.setValue(s),i=!0}return i}getProgress(){const{document:t,values:e}=this;let r=(this.duration-this.begin)/(this.maxDuration-this.begin),i,s;if(e.hasValue()){const a=r*(e.getValue().length-1),n=Math.floor(a),o=Math.ceil(a);let c;c=e.getValue()[n],i=new A(t,"from",c?parseFloat(c):0),c=e.getValue()[o],s=new A(t,"to",c?parseFloat(c):0),r=(a-n)/(o-n)}else i=this.from,s=this.to;return{progress:r,from:i,to:s}}constructor(t,e,r){super(t,e,r),this.type="animate",this.duration=0,this.initialUnits="",this.removed=!1,this.frozen=!1,t.screen.animations.push(this),this.begin=this.getAttribute("begin").getMilliseconds(),this.maxDuration=this.begin+this.getAttribute("dur").getMilliseconds(),this.from=this.getAttribute("from"),this.to=this.getAttribute("to"),this.values=new A(t,"values",null);const i=this.getAttribute("values");i.hasValue()&&this.values.setValue(i.getString().split(";"))}}class is extends Ee{calcValue(){const{progress:t,from:e,to:r}=this.getProgress(),i=new Te(e.getColor()),s=new Te(r.getColor());if(i.ok&&s.ok){const a=i.r+(s.r-i.r)*t,n=i.g+(s.g-i.g)*t,o=i.b+(s.b-i.b)*t;return"rgb(".concat(Math.floor(a),", ").concat(Math.floor(n),", ").concat(Math.floor(o),")")}return this.getAttribute("from").getColor()}constructor(...t){super(...t),this.type="animateColor"}}class ss extends Ee{calcValue(){const{progress:t,from:e,to:r}=this.getProgress(),i=ht(e.getString()),s=ht(r.getString());return i.map((a,n)=>{const o=s[n];return a+(o-a)*t}).join(" ")}constructor(...t){super(...t),this.type="animateTransform"}}class Nr extends j{constructor(t,e,r){super(t,e,r),this.type="font-face",this.ascent=this.getAttribute("ascent").getNumber(),this.descent=this.getAttribute("descent").getNumber(),this.unitsPerEm=this.getAttribute("units-per-em").getNumber()}}class Ne extends X{constructor(t,e,r){super(t,e,r),this.type="glyph",this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber(),this.unicode=this.getAttribute("unicode").getString(),this.arabicForm=this.getAttribute("arabic-form").getString()}}class Mr extends Ne{constructor(...t){super(...t),this.type="missing-glyph",this.horizAdvX=0}}class ns extends j{render(){}constructor(t,e,r){super(t,e,r),this.type="font",this.isArabic=!1,this.glyphs={},this.arabicGlyphs={},this.isRTL=!1,this.horizAdvX=this.getAttribute("horiz-adv-x").getNumber();const{definitions:i}=t,{children:s}=this;for(const a of s)if(a instanceof Nr){this.fontFace=a;const n=a.getStyle("font-family");n.hasValue()&&(i[n.getString()]=this)}else if(a instanceof Mr)this.missingGlyph=a;else if(a instanceof Ne)if(a.arabicForm){this.isRTL=!0,this.isArabic=!0;const n=this.arabicGlyphs[a.unicode];typeof n>"u"?this.arabicGlyphs[a.unicode]={[a.arabicForm]:a}:n[a.arabicForm]=a}else this.glyphs[a.unicode]=a}}class as extends At{getText(){const t=this.getHrefAttribute().getDefinition();if(t){const e=t.children[0];if(e)return e.getText()}return""}constructor(...t){super(...t),this.type="tref"}}class os extends At{getText(){return this.text}renderChildren(t){if(this.hasText){super.renderChildren(t);const{document:e,x:r,y:i}=this,{mouse:s}=e.screen,a=new A(e,"fontSize",it.parse(e.ctx.font).fontSize);s.isWorking()&&s.checkBoundingBox(this,new gt(r,i-a.getPixels("y"),r+this.measureText(t),i))}else if(this.children.length>0){const e=new Oe(this.document);e.children=this.children,e.parent=this,e.render(t)}}onClick(){const{window:t}=this.document;t&&t.open(this.getHrefAttribute().getString())}onMouseMove(){const t=this.document.ctx;t.canvas.style.cursor="pointer"}constructor(t,e,r){super(t,e,r),this.type="a";const{childNodes:i}=e,s=i[0],a=i.length>0&&Array.from(i).every(n=>n.nodeType===3);this.hasText=a,this.text=a?this.getTextFromNode(s):""}}class hs extends At{getText(){return this.text}path(t){const{dataArray:e}=this;t&&t.beginPath(),e.forEach(r=>{let{type:i,points:s}=r;switch(i){case O.LINE_TO:t&&t.lineTo(s[0],s[1]);break;case O.MOVE_TO:t&&t.moveTo(s[0],s[1]);break;case O.CURVE_TO:t&&t.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5]);break;case O.QUAD_TO:t&&t.quadraticCurveTo(s[0],s[1],s[2],s[3]);break;case O.ARC:{const[a,n,o,c,l,d,g,u]=s,p=o>c?o:c,f=o>c?1:o/c,m=o>c?c/o:1;t&&(t.translate(a,n),t.rotate(g),t.scale(f,m),t.arc(0,0,p,l,l+d,!!(1-u)),t.scale(1/f,1/m),t.rotate(-g),t.translate(-a,-n));break}case O.CLOSE_PATH:t&&t.closePath();break}})}renderChildren(t){this.setTextData(t),t.save();const e=this.parent.getStyle("text-decoration").getString(),r=this.getFontSize(),{glyphInfo:i}=this,s=t.fillStyle;e==="underline"&&t.beginPath(),i.forEach((a,n)=>{const{p0:o,p1:c,rotation:l,text:d}=a;t.save(),t.translate(o.x,o.y),t.rotate(l),t.fillStyle&&t.fillText(d,0,0),t.strokeStyle&&t.strokeText(d,0,0),t.restore(),e==="underline"&&(n===0&&t.moveTo(o.x,o.y+r/8),t.lineTo(c.x,c.y+r/5))}),e==="underline"&&(t.lineWidth=r/20,t.strokeStyle=s,t.stroke(),t.closePath()),t.restore()}getLetterSpacingAt(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.letterSpacingCache[t]||0}findSegmentToFitChar(t,e,r,i,s,a,n,o,c){let l=a,d=this.measureText(t,o);o===" "&&e==="justify"&&r<i&&(d+=(i-r)/s),c>-1&&(l+=this.getLetterSpacingAt(c));const g=this.textHeight/20,u=this.getEquidistantPointOnPath(l,g,0),p=this.getEquidistantPointOnPath(l+d,g,0),f={p0:u,p1:p},m=u&&p?Math.atan2(p.y-u.y,p.x-u.x):0;if(n){const y=Math.cos(Math.PI/2+m)*n,v=Math.cos(-m)*n;f.p0={...u,x:u.x+y,y:u.y+v},f.p1={...p,x:p.x+y,y:p.y+v}}return l+=d,{offset:l,segment:f,rotation:m}}measureText(t,e){const{measuresCache:r}=this,i=e||this.getText();if(r.has(i))return r.get(i);const s=this.measureTargetText(t,i);return r.set(i,s),s}setTextData(t){if(this.glyphInfo)return;const e=this.getText(),r=e.split(""),i=e.split(" ").length-1,s=this.parent.getAttribute("dx").split().map(x=>x.getPixels("x")),a=this.parent.getAttribute("dy").getPixels("y"),n=this.parent.getStyle("text-anchor").getString("start"),o=this.getStyle("letter-spacing"),c=this.parent.getStyle("letter-spacing");let l=0;!o.hasValue()||o.getValue()==="inherit"?l=c.getPixels():o.hasValue()&&o.getValue()!=="initial"&&o.getValue()!=="unset"&&(l=o.getPixels());const d=[],g=e.length;this.letterSpacingCache=d;for(let x=0;x<g;x++)d.push(typeof s[x]<"u"?s[x]:l);const u=d.reduce((x,w,E)=>E===0?0:x+w||0,0),p=this.measureText(t),f=Math.max(p+u,0);this.textWidth=p,this.textHeight=this.getFontSize(),this.glyphInfo=[];const m=this.getPathLength(),y=this.getStyle("startOffset").getNumber(0)*m;let v=0;(n==="middle"||n==="center")&&(v=-f/2),(n==="end"||n==="right")&&(v=-f),v+=y,r.forEach((x,w)=>{const{offset:E,segment:C,rotation:S}=this.findSegmentToFitChar(t,n,f,m,i,v,a,x,w);v=E,!(!C.p0||!C.p1)&&this.glyphInfo.push({text:r[w],p0:C.p0,p1:C.p1,rotation:S})})}parsePathData(t){if(this.pathLength=-1,!t)return[];const e=[],{pathParser:r}=t;for(r.reset();!r.isEnd();){const{current:i}=r,s=i?i.x:0,a=i?i.y:0,n=r.next();let o=n.type,c=[];switch(n.type){case O.MOVE_TO:this.pathM(r,c);break;case O.LINE_TO:o=this.pathL(r,c);break;case O.HORIZ_LINE_TO:o=this.pathH(r,c);break;case O.VERT_LINE_TO:o=this.pathV(r,c);break;case O.CURVE_TO:this.pathC(r,c);break;case O.SMOOTH_CURVE_TO:o=this.pathS(r,c);break;case O.QUAD_TO:this.pathQ(r,c);break;case O.SMOOTH_QUAD_TO:o=this.pathT(r,c);break;case O.ARC:c=this.pathA(r);break;case O.CLOSE_PATH:X.pathZ(r);break}n.type!==O.CLOSE_PATH?e.push({type:o,points:c,start:{x:s,y:a},pathLength:this.calcLength(s,a,o,c)}):e.push({type:O.CLOSE_PATH,points:[],pathLength:0})}return e}pathM(t,e){const{x:r,y:i}=X.pathM(t).point;e.push(r,i)}pathL(t,e){const{x:r,y:i}=X.pathL(t).point;return e.push(r,i),O.LINE_TO}pathH(t,e){const{x:r,y:i}=X.pathH(t).point;return e.push(r,i),O.LINE_TO}pathV(t,e){const{x:r,y:i}=X.pathV(t).point;return e.push(r,i),O.LINE_TO}pathC(t,e){const{point:r,controlPoint:i,currentPoint:s}=X.pathC(t);e.push(r.x,r.y,i.x,i.y,s.x,s.y)}pathS(t,e){const{point:r,controlPoint:i,currentPoint:s}=X.pathS(t);return e.push(r.x,r.y,i.x,i.y,s.x,s.y),O.CURVE_TO}pathQ(t,e){const{controlPoint:r,currentPoint:i}=X.pathQ(t);e.push(r.x,r.y,i.x,i.y)}pathT(t,e){const{controlPoint:r,currentPoint:i}=X.pathT(t);return e.push(r.x,r.y,i.x,i.y),O.QUAD_TO}pathA(t){let{rX:e,rY:r,sweepFlag:i,xAxisRotation:s,centp:a,a1:n,ad:o}=X.pathA(t);return i===0&&o>0&&(o-=2*Math.PI),i===1&&o<0&&(o+=2*Math.PI),[a.x,a.y,e,r,n,o,s,i]}calcLength(t,e,r,i){let s=0,a=null,n=null,o=0;switch(r){case O.LINE_TO:return this.getLineLength(t,e,i[0],i[1]);case O.CURVE_TO:for(s=0,a=this.getPointOnCubicBezier(0,t,e,i[0],i[1],i[2],i[3],i[4],i[5]),o=.01;o<=1;o+=.01)n=this.getPointOnCubicBezier(o,t,e,i[0],i[1],i[2],i[3],i[4],i[5]),s+=this.getLineLength(a.x,a.y,n.x,n.y),a=n;return s;case O.QUAD_TO:for(s=0,a=this.getPointOnQuadraticBezier(0,t,e,i[0],i[1],i[2],i[3]),o=.01;o<=1;o+=.01)n=this.getPointOnQuadraticBezier(o,t,e,i[0],i[1],i[2],i[3]),s+=this.getLineLength(a.x,a.y,n.x,n.y),a=n;return s;case O.ARC:{s=0;const c=i[4],l=i[5],d=i[4]+l;let g=Math.PI/180;if(Math.abs(c-d)<g&&(g=Math.abs(c-d)),a=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],c,0),l<0)for(o=c-g;o>d;o-=g)n=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],o,0),s+=this.getLineLength(a.x,a.y,n.x,n.y),a=n;else for(o=c+g;o<d;o+=g)n=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],o,0),s+=this.getLineLength(a.x,a.y,n.x,n.y),a=n;return n=this.getPointOnEllipticalArc(i[0],i[1],i[2],i[3],d,0),s+=this.getLineLength(a.x,a.y,n.x,n.y),s}}return 0}getPointOnLine(t,e,r,i,s){let a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:e,n=arguments.length>6&&arguments[6]!==void 0?arguments[6]:r;const o=(s-r)/(i-e+Dt);let c=Math.sqrt(t*t/(1+o*o));i<e&&(c*=-1);let l=o*c,d=null;if(i===e)d={x:a,y:n+l};else if((n-r)/(a-e+Dt)===o)d={x:a+c,y:n+l};else{let g=0,u=0;const p=this.getLineLength(e,r,i,s);if(p<Dt)return null;let f=(a-e)*(i-e)+(n-r)*(s-r);f/=p*p,g=e+f*(i-e),u=r+f*(s-r);const m=this.getLineLength(a,n,g,u),y=Math.sqrt(t*t-m*m);c=Math.sqrt(y*y/(1+o*o)),i<e&&(c*=-1),l=o*c,d={x:g+c,y:u+l}}return d}getPointOnPath(t){const e=this.getPathLength();let r=0,i=null;if(t<-5e-5||t-5e-5>e)return null;const{dataArray:s}=this;for(const a of s){if(a&&(a.pathLength<5e-5||r+a.pathLength+5e-5<t)){r+=a.pathLength;continue}const n=t-r;let o=0;switch(a.type){case O.LINE_TO:i=this.getPointOnLine(n,a.start.x,a.start.y,a.points[0],a.points[1],a.start.x,a.start.y);break;case O.ARC:{const c=a.points[4],l=a.points[5],d=a.points[4]+l;if(o=c+n/a.pathLength*l,l<0&&o<d||l>=0&&o>d)break;i=this.getPointOnEllipticalArc(a.points[0],a.points[1],a.points[2],a.points[3],o,a.points[6]);break}case O.CURVE_TO:o=n/a.pathLength,o>1&&(o=1),i=this.getPointOnCubicBezier(o,a.start.x,a.start.y,a.points[0],a.points[1],a.points[2],a.points[3],a.points[4],a.points[5]);break;case O.QUAD_TO:o=n/a.pathLength,o>1&&(o=1),i=this.getPointOnQuadraticBezier(o,a.start.x,a.start.y,a.points[0],a.points[1],a.points[2],a.points[3]);break}if(i)return i;break}return null}getLineLength(t,e,r,i){return Math.sqrt((r-t)*(r-t)+(i-e)*(i-e))}getPathLength(){return this.pathLength===-1&&(this.pathLength=this.dataArray.reduce((t,e)=>e.pathLength>0?t+e.pathLength:t,0)),this.pathLength}getPointOnCubicBezier(t,e,r,i,s,a,n,o,c){const l=o*Je(t)+a*Ke(t)+i*tr(t)+e*er(t),d=c*Je(t)+n*Ke(t)+s*tr(t)+r*er(t);return{x:l,y:d}}getPointOnQuadraticBezier(t,e,r,i,s,a,n){const o=a*rr(t)+i*ir(t)+e*sr(t),c=n*rr(t)+s*ir(t)+r*sr(t);return{x:o,y:c}}getPointOnEllipticalArc(t,e,r,i,s,a){const n=Math.cos(a),o=Math.sin(a),c={x:r*Math.cos(s),y:i*Math.sin(s)};return{x:t+(c.x*n-c.y*o),y:e+(c.x*o+c.y*n)}}buildEquidistantCache(t,e){const r=this.getPathLength(),i=e||.25,s=t||r/100;if(!this.equidistantCache||this.equidistantCache.step!==s||this.equidistantCache.precision!==i){this.equidistantCache={step:s,precision:i,points:[]};let a=0;for(let n=0;n<=r;n+=i){const o=this.getPointOnPath(n),c=this.getPointOnPath(n+i);!o||!c||(a+=this.getLineLength(o.x,o.y,c.x,c.y),a>=s&&(this.equidistantCache.points.push({x:o.x,y:o.y,distance:n}),a-=s))}}}getEquidistantPointOnPath(t,e,r){if(this.buildEquidistantCache(e,r),t<0||t-this.getPathLength()>5e-5)return null;const i=Math.round(t/this.getPathLength()*(this.equidistantCache.points.length-1));return this.equidistantCache.points[i]||null}constructor(t,e,r){super(t,e,r),this.type="textPath",this.textWidth=0,this.textHeight=0,this.pathLength=-1,this.glyphInfo=null,this.letterSpacingCache=[],this.measuresCache=new Map([["",0]]);const i=this.getHrefAttribute().getDefinition();this.text=this.getTextFromNode(),this.dataArray=this.parsePathData(i)}}const cs=/^\s*data:(([^/,;]+\/[^/,;]+)(?:;([^,;=]+=[^,;=]+))?)?(?:;(base64))?,(.*)$/i;class ls extends Vt{async loadImage(t){try{const e=await this.document.createImage(t);this.image=e}catch(e){console.error('Error while loading image "'.concat(t,'":'),e)}this.loaded=!0}async loadSvg(t){const e=cs.exec(t);if(e){const r=e[5];r&&(e[4]==="base64"?this.image=atob(r):this.image=decodeURIComponent(r))}else try{const r=await(await this.document.fetch(t)).text();this.image=r}catch(r){console.error('Error while loading image "'.concat(t,'":'),r)}this.loaded=!0}renderChildren(t){const{document:e,image:r,loaded:i}=this,s=this.getAttribute("x").getPixels("x"),a=this.getAttribute("y").getPixels("y"),n=this.getStyle("width").getPixels("x"),o=this.getStyle("height").getPixels("y");if(!(!i||!r||!n||!o)){if(t.save(),t.translate(s,a),typeof r=="string"){const c=e.canvg.forkString(t,r,{ignoreMouse:!0,ignoreAnimation:!0,ignoreDimensions:!0,ignoreClear:!0,offsetX:0,offsetY:0,scaleWidth:n,scaleHeight:o}),{documentElement:l}=c.document;l&&(l.parent=this),c.render()}else e.setViewBox({ctx:t,aspectRatio:this.getAttribute("preserveAspectRatio").getString(),width:n,desiredWidth:r.width,height:o,desiredHeight:r.height}),this.loaded&&(!("complete"in r)||r.complete)&&t.drawImage(r,0,0);t.restore()}}getBoundingBox(){const t=this.getAttribute("x").getPixels("x"),e=this.getAttribute("y").getPixels("y"),r=this.getStyle("width").getPixels("x"),i=this.getStyle("height").getPixels("y");return new gt(t,e,t+r,e+i)}constructor(t,e,r){super(t,e,r),this.type="image",this.loaded=!1;const i=this.getHrefAttribute().getString();if(!i)return;const s=i.endsWith(".svg")||/^\s*data:image\/svg\+xml/i.test(i);t.images.push(this),s?this.loadSvg(i):this.loadImage(i)}}class us extends Vt{render(t){}constructor(...t){super(...t),this.type="symbol"}}class gs{async load(t,e){try{const{document:r}=this,i=(await r.canvg.parser.load(e)).getElementsByTagName("font");Array.from(i).forEach(s=>{const a=r.createElement(s);r.definitions[t]=a})}catch(r){console.error('Error while loading font "'.concat(e,'":'),r)}this.loaded=!0}constructor(t){this.document=t,this.loaded=!1,t.fonts.push(this)}}class kr extends j{constructor(t,e,r){super(t,e,r),this.type="style",$t(Array.from(e.childNodes).map(i=>i.textContent).join("").replace(/(\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"").replace(/@import.*;/g,"")).split("}").forEach(i=>{const s=i.trim();if(!s)return;const a=s.split("{"),n=a[0].split(","),o=a[1].split(";");n.forEach(c=>{const l=c.trim();if(!l)return;const d=t.styles[l]||{};if(o.forEach(g=>{const u=g.indexOf(":"),p=g.substr(0,u).trim(),f=g.substr(u+1,g.length-u).trim();p&&f&&(d[p]=new A(t,p,f))}),t.styles[l]=d,t.stylesSpecificity[l]=Mi(l),l==="@font-face"){const g=d["font-family"].getString().replace(/"|'/g,"");d.src.getString().split(",").forEach(u=>{if(u.indexOf('format("svg")')>0){const p=wr(u);p&&new gs(t).load(g,p)}})}})})}}kr.parseExternalUrl=wr;class ds extends Vt{setContext(t){super.setContext(t);const e=this.getAttribute("x"),r=this.getAttribute("y");e.hasValue()&&t.translate(e.getPixels("x"),0),r.hasValue()&&t.translate(0,r.getPixels("y"))}path(t){const{element:e}=this;e&&e.path(t)}renderChildren(t){const{document:e,element:r}=this;if(r){let i=r;if(r.type==="symbol"&&(i=new jt(e),i.attributes.viewBox=new A(e,"viewBox",r.getAttribute("viewBox").getString()),i.attributes.preserveAspectRatio=new A(e,"preserveAspectRatio",r.getAttribute("preserveAspectRatio").getString()),i.attributes.overflow=new A(e,"overflow",r.getAttribute("overflow").getString()),i.children=r.children,r.styles.opacity=new A(e,"opacity",this.calculateOpacity())),i.type==="svg"){const a=this.getStyle("width",!1,!0),n=this.getStyle("height",!1,!0);a.hasValue()&&(i.attributes.width=new A(e,"width",a.getString())),n.hasValue()&&(i.attributes.height=new A(e,"height",n.getString()))}const s=i.parent;i.parent=this,i.render(t),i.parent=s}}getBoundingBox(t){const{element:e}=this;return e?e.getBoundingBox(t):null}elementTransform(){const{document:t,element:e}=this;return e?kt.fromElement(t,e):null}get element(){return this.cachedElement||(this.cachedElement=this.getHrefAttribute().getDefinition()),this.cachedElement}constructor(...t){super(...t),this.type="use"}}function re(h,t,e,r,i,s){return h[e*r*4+t*4+s]}function ie(h,t,e,r,i,s,a){h[e*r*4+t*4+s]=a}function J(h,t,e){return h[t]*e}function mt(h,t,e,r){return t+Math.cos(h)*e+Math.sin(h)*r}class Vr extends j{apply(t,e,r,i,s){const{includeOpacity:a,matrix:n}=this,o=t.getImageData(0,0,i,s);for(let c=0;c<s;c++)for(let l=0;l<i;l++){const d=re(o.data,l,c,i,s,0),g=re(o.data,l,c,i,s,1),u=re(o.data,l,c,i,s,2),p=re(o.data,l,c,i,s,3);let f=J(n,0,d)+J(n,1,g)+J(n,2,u)+J(n,3,p)+J(n,4,1),m=J(n,5,d)+J(n,6,g)+J(n,7,u)+J(n,8,p)+J(n,9,1),y=J(n,10,d)+J(n,11,g)+J(n,12,u)+J(n,13,p)+J(n,14,1),v=J(n,15,d)+J(n,16,g)+J(n,17,u)+J(n,18,p)+J(n,19,1);a&&(f=0,m=0,y=0,v*=p/255),ie(o.data,l,c,i,s,0,f),ie(o.data,l,c,i,s,1,m),ie(o.data,l,c,i,s,2,y),ie(o.data,l,c,i,s,3,v)}t.clearRect(0,0,i,s),t.putImageData(o,0,0)}constructor(t,e,r){super(t,e,r),this.type="feColorMatrix";let i=ht(this.getAttribute("values").getString());switch(this.getAttribute("type").getString("matrix")){case"saturate":{const s=i[0];i=[.213+.787*s,.715-.715*s,.072-.072*s,0,0,.213-.213*s,.715+.285*s,.072-.072*s,0,0,.213-.213*s,.715-.715*s,.072+.928*s,0,0,0,0,0,1,0,0,0,0,0,1];break}case"hueRotate":{const s=i[0]*Math.PI/180;i=[mt(s,.213,.787,-.213),mt(s,.715,-.715,-.715),mt(s,.072,-.072,.928),0,0,mt(s,.213,-.213,.143),mt(s,.715,.285,.14),mt(s,.072,-.072,-.283),0,0,mt(s,.213,-.213,-.787),mt(s,.715,-.715,.715),mt(s,.072,.928,.072),0,0,0,0,0,1,0,0,0,0,0,1];break}case"luminanceToAlpha":i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2125,.7154,.0721,0,0,0,0,0,0,1];break}this.matrix=i,this.includeOpacity=this.getAttribute("includeOpacity").hasValue()}}class oe extends j{apply(t,e){const{document:r}=this;let i=this.getAttribute("x").getPixels("x"),s=this.getAttribute("y").getPixels("y"),a=this.getStyle("width").getPixels("x"),n=this.getStyle("height").getPixels("y");if(!a&&!n){const u=new gt;this.children.forEach(p=>{u.addBoundingBox(p.getBoundingBox(t))}),i=Math.floor(u.x1),s=Math.floor(u.y1),a=Math.floor(u.width),n=Math.floor(u.height)}const o=this.removeStyles(e,oe.ignoreStyles),c=r.createCanvas(i+a,s+n),l=c.getContext("2d");r.screen.setDefaults(l),this.renderChildren(l),new Vr(r,{nodeType:1,childNodes:[],attributes:[{nodeName:"type",value:"luminanceToAlpha"},{nodeName:"includeOpacity",value:"true"}]}).apply(l,0,0,i+a,s+n);const d=r.createCanvas(i+a,s+n),g=d.getContext("2d");r.screen.setDefaults(g),e.render(g),g.globalCompositeOperation="destination-in",g.fillStyle=l.createPattern(c,"no-repeat"),g.fillRect(0,0,i+a,s+n),t.fillStyle=g.createPattern(d,"no-repeat"),t.fillRect(0,0,i+a,s+n),this.restoreStyles(e,o)}render(t){}constructor(...t){super(...t),this.type="mask"}}oe.ignoreStyles=["mask","transform","clip-path"];const ar=()=>{};class ps extends j{apply(t){const{document:e}=this,r=Reflect.getPrototypeOf(t),{beginPath:i,closePath:s}=t;r&&(r.beginPath=ar,r.closePath=ar),Reflect.apply(i,t,[]),this.children.forEach(a=>{if(!("path"in a))return;let n="elementTransform"in a?a.elementTransform():null;n||(n=kt.fromElement(e,a)),n&&n.apply(t),a.path(t),r&&(r.closePath=s),n&&n.unapply(t)}),Reflect.apply(s,t,[]),t.clip(),r&&(r.beginPath=i,r.closePath=s)}render(t){}constructor(...t){super(...t),this.type="clipPath"}}class he extends j{apply(t,e){const{document:r,children:i}=this,s="getBoundingBox"in e?e.getBoundingBox(t):null;if(!s)return;let a=0,n=0;i.forEach(y=>{const v=y.extraFilterDistance||0;a=Math.max(a,v),n=Math.max(n,v)});const o=Math.floor(s.width),c=Math.floor(s.height),l=o+2*a,d=c+2*n;if(l<1||d<1)return;const g=Math.floor(s.x),u=Math.floor(s.y),p=this.removeStyles(e,he.ignoreStyles),f=r.createCanvas(l,d),m=f.getContext("2d");r.screen.setDefaults(m),m.translate(-g+a,-u+n),e.render(m),i.forEach(y=>{typeof y.apply=="function"&&y.apply(m,0,0,l,d)}),t.drawImage(f,0,0,l,d,g-a,u-n,l,d),this.restoreStyles(e,p)}render(t){}constructor(...t){super(...t),this.type="filter"}}he.ignoreStyles=["filter","transform","clip-path"];class fs extends j{apply(t,e,r,i,s){}constructor(t,e,r){super(t,e,r),this.type="feDropShadow",this.addStylesFromStyleDefinition()}}class ms extends j{apply(t,e,r,i,s){}constructor(...t){super(...t),this.type="feMorphology"}}class ys extends j{apply(t,e,r,i,s){}constructor(...t){super(...t),this.type="feComposite"}}class xs extends j{apply(t,e,r,i,s){const{document:a,blurRadius:n}=this,o=a.window?a.window.document.body:null,c=t.canvas;c.id=a.getUniqueId(),o&&(c.style.display="none",o.appendChild(c)),fi(c,e,r,i,s,n),o&&o.removeChild(c)}constructor(t,e,r){super(t,e,r),this.type="feGaussianBlur",this.blurRadius=Math.floor(this.getAttribute("stdDeviation").getNumber()),this.extraFilterDistance=this.blurRadius}}class bs extends j{constructor(...t){super(...t),this.type="title"}}class vs extends j{constructor(...t){super(...t),this.type="desc"}}const ws={svg:jt,rect:Pr,circle:Wi,ellipse:ji,line:Qi,polyline:Or,polygon:Gi,path:X,pattern:Zi,marker:Ji,defs:Ki,linearGradient:ts,radialGradient:es,stop:rs,animate:Ee,animateColor:is,animateTransform:ss,font:ns,"font-face":Nr,"missing-glyph":Mr,glyph:Ne,text:At,tspan:ae,tref:as,a:os,textPath:hs,image:ls,g:Oe,symbol:us,style:kr,use:ds,mask:oe,clipPath:ps,filter:he,feDropShadow:fs,feMorphology:ms,feComposite:ys,feColorMatrix:Vr,feGaussianBlur:xs,title:bs,desc:vs};function Ss(h,t){const e=document.createElement("canvas");return e.width=h,e.height=t,e}async function As(h){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;const e=document.createElement("img");return t&&(e.crossOrigin="Anonymous"),new Promise((r,i)=>{e.onload=()=>{r(e)},e.onerror=(s,a,n,o,c)=>{i(c)},e.src=h})}const Se=12;class St{bindCreateImage(t,e){return typeof e=="boolean"?(r,i)=>t(r,typeof i=="boolean"?i:e):t}get window(){return this.screen.window}get fetch(){return this.screen.fetch}get ctx(){return this.screen.ctx}get emSize(){const{emSizeStack:t}=this;return t[t.length-1]||Se}set emSize(t){const{emSizeStack:e}=this;e.push(t)}popEmSize(){const{emSizeStack:t}=this;t.pop()}getUniqueId(){return"canvg".concat(++this.uniqueId)}isImagesLoaded(){return this.images.every(t=>t.loaded)}isFontsLoaded(){return this.fonts.every(t=>t.loaded)}createDocumentElement(t){const e=this.createElement(t.documentElement);return e.root=!0,e.addStylesFromStyleDefinition(),this.documentElement=e,e}createElement(t){const e=t.nodeName.replace(/^[^:]+:/,""),r=St.elementTypes[e];return r?new r(this,t):new Fi(this,t)}createTextNode(t){return new qi(this,t)}setViewBox(t){this.screen.setViewBox({document:this,...t})}constructor(t,{rootEmSize:e=Se,emSize:r=Se,createCanvas:i=St.createCanvas,createImage:s=St.createImage,anonymousCrossOrigin:a}={}){this.canvg=t,this.definitions={},this.styles={},this.stylesSpecificity={},this.images=[],this.fonts=[],this.emSizeStack=[],this.uniqueId=0,this.screen=t.screen,this.rootEmSize=e,this.emSize=r,this.createCanvas=i,this.createImage=this.bindCreateImage(s,a),this.screen.wait(()=>this.isImagesLoaded()),this.screen.wait(()=>this.isFontsLoaded())}}St.createCanvas=Ss;St.createImage=As;St.elementTypes=ws;class _t{static async from(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=await new we(r).parse(e);return new _t(t,i,r)}static fromString(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const i=new we(r).parseFromString(e);return new _t(t,i,r)}fork(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return _t.from(t,e,{...this.options,...r})}forkString(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return _t.fromString(t,e,{...this.options,...r})}ready(){return this.screen.ready()}isReady(){return this.screen.isReady()}async render(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.start({enableRedraw:!0,ignoreAnimation:!0,ignoreMouse:!0,...t}),await this.ready(),this.stop()}start(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{documentElement:e,screen:r,options:i}=this;r.start(e,{enableRedraw:!0,...i,...t})}stop(){this.screen.stop()}resize(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:t,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.documentElement.resize(t,e,r)}constructor(t,e,r={}){this.parser=new we(r),this.screen=new xt(t,r),this.options=r;const i=new St(this,r),s=i.createDocumentElement(e);this.document=i,this.documentElement=s}}const Ts=["innerHTML"],Cs=or({__name:"SvgWrapper",props:{svg:null},setup(h){return(t,e)=>(vt(),Mt("div",{innerHTML:h.svg},null,8,Ts))}}),Ps=["src"],Os={key:1},Es={key:2},Ns={class:"toolbar-outer"},Ms={class:"toolbar"},ks={class:"toolbar-inner glowing"},Vs=or({__name:"Cuiping",props:{molecule:null,useImage:{type:Boolean,default:!1},imageScale:{default:1},renderOptions:null,genTestCase:{type:Boolean}},setup(h,{expose:t}){const e=h,r=Rr(()=>{var m;if(!e.molecule)return{state:"empty"};let y="";const v=si(e.molecule,{onError:x=>{y=x.message,console.warn(x)},renderer:"svg",rendererOptions:(m=e.renderOptions)!=null?m:{}});return v?{state:"ok",data:v}:{state:"error",errMsg:y}});function i(){if(r.value.state!=="ok")return;const m=new Blob([r.value.data.svg]),y=URL.createObjectURL(m),v=document.createElement("a");v.download=`${r.value.data.id}.svg`,v.href=y,v.click(),URL.revokeObjectURL(y)}const s=Ft("Cuiping");function a(){s.value==="Cuiping"&&(s.value="Copying...",e.molecule&&navigator.clipboard.writeText(e.molecule).finally(()=>{s.value="Copied",setTimeout(()=>{s.value="Cuiping"},700)}))}const n=Ft(1);function o(){n.value>2?n.value-=.5:n.value>1&&(n.value-=.25)}function c(){n.value<2?n.value+=.25:n.value<4&&(n.value+=.5)}const l=Ft(),d=Ft(),g=Ft(0);let u;const p=()=>{g.value++};_r([l,e,g],()=>{if(l.value&&e.useImage&&e.molecule&&r.value.state==="ok"){const m=r.value.data.svg.replace(/width="([\d.]+)"/,(v,x)=>`width="${x*e.imageScale}"`).replace(/height="([\d.]+)"/,(v,x)=>`height="${x*e.imageScale}"`);u&&u.stop();const y=l.value.getContext("2d");u=_t.fromString(y,m),u.start(),d.value=l.value.toDataURL()}});const f=()=>{!e.molecule||r.value.state==="empty"||navigator.clipboard.writeText(`[ ${JSON.stringify(e.molecule)}, ${r.value.state==="ok"?JSON.stringify(r.value.data.svg.replace(/ id=".+?" xmlns=".+?"/,"").replace(/<style>.+<\/style>/,"")):`Error(${JSON.stringify(r.value.errMsg)})`} ],
`)};return t({res:r,redraw:p}),(m,y)=>(vt(),Mt("div",{class:Ie(["root",{[Ot(r).state]:!0,testmode:e.genTestCase}])},[Ot(r).state==="ok"?(vt(),Mt("div",{key:0,class:Ie(["container",{glowing:n.value!==1}]),style:Le({width:Ot(r).data.width+"px",height:Ot(r).data.height+"px",transform:`scale(${n.value})`,transformOrigin:"left top"})},[h.useImage?(vt(),Mt("div",{key:0,style:Le({transform:h.useImage?`scale(${1/h.imageScale})`:void 0,transformOrigin:"left top"})},[pt("canvas",{ref_key:"canvas",ref:l},null,512),pt("img",{src:d.value},null,8,Ps)],4)):(vt(),Ir(Cs,{svg:Ot(r).data.svg,key:g.value},null,8,["svg"]))],6)):Ot(r).state==="error"?(vt(),Mt("p",Os,xe(Ot(r).errMsg),1)):(vt(),Mt("p",Es,"...")),pt("div",Ns,[pt("div",Ms,[pt("div",ks,[pt("button",{onClick:c},"+"),pt("button",{onClick:y[0]||(y[0]=v=>n.value=1)},xe(n.value*100)+"%",1),pt("button",{onClick:o},"-"),pt("button",{onClick:i},"SVG"),pt("button",{onClick:a},xe(s.value),1),h.genTestCase?(vt(),Mt("button",{key:0,onClick:f},"TestCase")):Lr("",!0)])])])],2))}}),Rs=(h,t)=>{const e=h.__vccOpts||h;for(const[r,i]of t)e[r]=i;return e},_s=Rs(Vs,[["__scopeId","data-v-6116e5c0"]]),Ls={install(h){h.component("Cuiping",_s)}};export{_s as Cuiping,Ls as default};
